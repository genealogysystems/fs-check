# fs-check
Generate research opportunities for the [FamilySearch Family Tree](https://familysearch.org/tree/).

fs-check depends on the [FamilySearch-javascript-sdk](https://github.com/rootsdev/familysearch-javascript-sdk) and was designed to be paired with [fs-traversal](https://github.com/genealogysystems/fs-traversal).

FSCheck is an object with opportunities arranged by function signature. This was done to match the function signatures provided by fs-traversal.
````javascript
{
  // function(Person)
  person: {...},
  
  // function(Person, SourceRefs)
  personSource: {...},
  
  // function(Wife, Husband, Marriage)
  marriage: {...},
  
  // function(Wife, Husband, Marriage, Sourcerefs)
  marriageSource: {...},
  
  // function(Person, Mother, Father, ChildRelationship)
  child: {...},
  
  // function(Person, Children)
  children: {...},
  
  // function(Person, Parents)
  parents: {...},

   // function(Person, Relationships, People)
  relationships: {...}
}
````

# Usage

````javascript

// fs-check was designed to be paired with fs-traversal
var FS = FamilySearch.init({});
var traversal = FSTraversal(FS)
      .order('wrd')
      .person(function(person) {

        // Get a list of all checks that match the "person" function signature
        var checks = FSCheck.signature('person');
        for(var i = 0; i < checks.length; i++){
        
          // Call the check function to generate an opportunity
          var opportunity = checks[i].check(person);
          
          // Check functions return nothing (undefined) when there is
          // no opportunity. For example, the missingBirth check will
          // not return an opportunity for someone that has birth information
          if(opportunity){
            // Do something with it
          }
        }

      });
      
// Checks can be called by type (useful for display purposes)
var problemChecks = FSCheck.type('problem');

// Checks can be called by ID
var missingBirthCheck = FSCheck.id('missingBirth');
var missingBirthOpportunity = missingBirthCheck.check(person);
````

## Browser
Download [fs-check.js](fs-check.js) and enjoy.
(Packaged with love by [browserify](http://browserify.org/))

## Node.js
Unsuported for now. Waiting on [this issue](https://github.com/rootsdev/familysearch-javascript-sdk/issues/8) in the FamilySearch Javascript SDK.

# Opportunities

View a [list of the checks grouped by signature and type](lib/checks) or view examples of the opportunities generated by those checks on the [demo site](http://genealogysystems.github.io/fs-check/).

## Schema
````javascript
{
  type: ''
  title: '',
  description: '',
  person: FamilySearch.Person(),
  findarecord: {},
  gensearch: {}
}
````

### type
The type of opportunity. Will be a string matching one of:

* `problem`
* `cleanup`
* `source`
* `person`
* `family`

### title
The title of the opportunity. Plain text only.

### description
A description of the opportunity, including hints, notes, best practices, and generally anything that may be useful.
The description usually contains html.

### person
The FamilySearch person that this opportunity is for. `person` will be a `FamilySearch.Person()` object.

### findarecord
An object containing parameters to use for a Find-A-Record Search. Must be a valid object or `undefined`.
````javascript
{
  tags: ['birth']
  from: 1900,
  to: 1950,
  place: 'Provo, Utah, United States of America',
  radius: 10000
}
````

* `tags` - An array of tags to filter the search using. Possible values are `birth`, `marriage`, `death`, `census`, `misc`. Required.
* `from` - An integer that limits the Find-A-Record search to return collections containing records covering dates on or after `from`. May also be `undefined`.
* `to` - An integer that limits the Find-A-Record search to return collections containing records covering dates on or before `to`. May also be `undefined`.
* `place` - A String representing the place to search. Required.
* `radius` - The radius of the Find-A-Record Search in meters. May be `undefined`.

### gensearch
A gen-search object matching [schema](https://github.com/genealogysystems/gen-search#schema) or `undefined`.

# Contributing
Every pull request that adds a check should contain the following things:

1. A check that returns ONE opportunity. (Look at existing checks and follow the conventions)
1. An update to [lib/index.js](lib/index.js) to register your check.
1. A set of test cases that provide 100% code coverage for your check.
1. One instance of `doc('checkName', opportunity)` in one of your test cases to document your check for gh-pages.
1. An update to the docs by running `npm run docs`.

Be careful not to add a check that overlaps with another check.

````bash
# To run the tests
npm test

# To generate the code coverage
npm run coverage

# To build the docs
npm run docs

# To build the library with browserify
npm run build
````

Run `node server.js` to get a simple web server that allows you to view the coverage (localhost:8888/coverage/coverage.html) and documentation (localhost:8888).

Make sure you install [mocha](http://visionmedia.github.io/mocha/) and [jscoverage](https://github.com/visionmedia/node-jscoverage) globally before generating coverage.

# License
[MIT](LICENSE)