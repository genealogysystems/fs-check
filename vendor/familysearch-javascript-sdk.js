!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.FamilySearch=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){function c(a,b){l.prototype[b]=function(){return this[a][b].apply(this[a],arguments)}}var d=a("./globals"),e=a("./utils"),f=a("./angularjs-wrappers"),g=a("./jquery-wrappers"),h=a("./nodejs-wrappers"),i=a("./helpers"),j=a("./plumbing"),k=0,l=b.exports=function(a){var b=this;if(b.settings=e.extend(b.settings,d),b.settings.instanceId=++k,b.helpers=new i(b),b.plumbing=new j(b),a=a||{},!a.client_id&&!a.app_key)throw"client_id must be set";if(b.settings.clientId=a.client_id||a.app_key,!a.environment)throw"environment must be set";if(b.settings.environment=a.environment,!a.http_function&&!window.jQuery)throw"http must be set; e.g., jQuery.ajax";var c=a.http_function||window.jQuery.ajax;if(b.settings.httpWrapper=c.defaults?f.httpWrapper(c,b):c.cookie?h.httpWrapper(c,b):g.httpWrapper(c,b),!a.deferred_function&&!window.jQuery)throw"deferred_function must be set; e.g., jQuery.Deferred";var l=a.deferred_function||window.jQuery.Deferred,m=l();m.resolve(),b.settings.deferredWrapper=e.isFunction(m.promise)?g.deferredWrapper(l):e.isFunction(l.nfcall)?h.deferredWrapper(l):f.deferredWrapper(l);var n=a.timeout_function;n?(b.settings.setTimeout=function(a,b){return n(a,b)},b.settings.clearTimeout=function(a){n.cancel(a)}):(b.settings.setTimeout=function(a,b){return setTimeout(a,b)},b.settings.clearTimeout=function(a){clearTimeout(a)}),b.settings.redirectUri=a.redirect_uri||a.auth_callback,b.settings.autoSignin=a.auto_signin,b.settings.autoExpire=a.auto_expire,b.settings.expireCallback=a.expire_callback,a.save_access_token&&(b.settings.saveAccessToken=!0,b.helpers.readAccessToken()),a.access_token&&(b.settings.accessToken=a.access_token),b.settings.debug=a.debug,b.settings.discoveryPromise=b.plumbing.get(b.settings.discoveryUrl),b.settings.discoveryPromise.then(function(a){b.settings.discoveryResource=a})};l.BaseClass=function(a,b){e.isObject(b)&&e.extend(this,b),this.$client=a,this.$helpers=a.helpers,this.$plumbing=a.plumbing},a("./modules/authorities"),a("./modules/authentication"),a("./modules/changeHistory"),a("./modules/discussions"),a("./modules/memories"),a("./modules/notes"),a("./modules/parentsAndChildren"),a("./modules/pedigree"),a("./modules/persons"),a("./modules/redirect"),a("./modules/searchAndMatch"),a("./modules/sourceBox"),a("./modules/sources"),a("./modules/spouses"),a("./modules/users"),a("./classes/agent"),a("./classes/attribution"),a("./classes/change"),a("./classes/childAndParents"),a("./classes/collection"),a("./classes/comment"),a("./classes/couple"),a("./classes/date"),a("./classes/discussion"),a("./classes/discussionRef"),a("./classes/fact"),a("./classes/memoryArtifactRef"),a("./classes/memoryPersona"),a("./classes/memoryPersonaRef"),a("./classes/memory"),a("./classes/name"),a("./classes/note"),a("./classes/person"),a("./classes/place"),a("./classes/searchResult"),a("./classes/sourceDescription"),a("./classes/sourceRef"),a("./classes/user"),c("plumbing","del"),c("plumbing","get"),c("plumbing","getTotalProcessingTime"),c("plumbing","getUrl"),c("plumbing","http"),c("plumbing","post"),c("plumbing","put"),c("plumbing","setTotalProcessingTime")},{"./angularjs-wrappers":2,"./classes/agent":3,"./classes/attribution":4,"./classes/change":5,"./classes/childAndParents":6,"./classes/collection":7,"./classes/comment":8,"./classes/couple":9,"./classes/date":10,"./classes/discussion":11,"./classes/discussionRef":12,"./classes/fact":13,"./classes/memory":14,"./classes/memoryArtifactRef":15,"./classes/memoryPersona":16,"./classes/memoryPersonaRef":17,"./classes/name":18,"./classes/note":19,"./classes/person":20,"./classes/place":21,"./classes/searchResult":22,"./classes/sourceDescription":23,"./classes/sourceRef":24,"./classes/user":25,"./globals":26,"./helpers":27,"./jquery-wrappers":28,"./modules/authentication":29,"./modules/authorities":30,"./modules/changeHistory":31,"./modules/discussions":32,"./modules/memories":33,"./modules/notes":34,"./modules/parentsAndChildren":35,"./modules/pedigree":36,"./modules/persons":37,"./modules/redirect":38,"./modules/searchAndMatch":39,"./modules/sourceBox":40,"./modules/sources":41,"./modules/spouses":42,"./modules/users":43,"./nodejs-wrappers":44,"./plumbing":45,"./utils":47}],2:[function(a,b,c){var d=a("./utils"),c={};c.httpWrapper=function(a,b){return function(c,e,f,g,h){var i=d.extend({method:c,url:e,responseType:"json",data:g,transformRequest:function(a){return a}},h);i.headers=d.extend({},f,h.headers),"multipart/form-data"===i.headers["Content-Type"]&&(i.headers["Content-Type"]=void 0);var j=a(i),k=b.settings.deferredWrapper(),l=k.promise,m=null,n=null;return j.then(function(a){m=a.status,n=a.headers,k.resolve(a.data)},function(a){m=a.status,n=a.headers,k.reject(a)}),l.getStatusCode=function(){return m},l.getResponseHeader=function(a){return n(a)},l.getAllResponseHeaders=function(){return n()},l.getRequest=function(){return i},l}},c.deferredWrapper=function(a){return function(){var b=a();return{promise:b.promise,resolve:b.resolve,reject:b.reject}}},b.exports=c},{"./utils":47}],3:[function(a){var b=a("./../FamilySearch"),c=a("./../utils"),d=c.maybe,e=b.Agent=function(a,c){b.BaseClass.call(this,a,c)};b.prototype.createAgent=function(a){return new e(this,a)},e.prototype={constructor:e,$getName:function(){return d(d(this.names)[0]).value},$getAccountName:function(){return d(d(this.accounts)[0]).accountName},$getEmail:function(){var a=d(d(this.emails)[0]).resource;return a?a.replace(/^mailto:/,""):a},$getPhoneNumber:function(){return d(d(this.phones)[0]).resource},$getAddress:function(){return d(d(this.addresses)[0]).value}}},{"./../FamilySearch":1,"./../utils":47}],4:[function(a){var b=a("./../FamilySearch"),c=a("./../utils"),d=c.maybe,e=b.Attribution=function(a,d){b.BaseClass.call(this,a,d),c.isString(d)&&(this.changeMessage=d)};b.prototype.createAttribution=function(a){return new e(this,a)},e.prototype={constructor:e,$getAgentId:function(){return d(this.contributor).resourceId},$getAgentUrl:function(){return this.$client.helpers.removeAccessToken(d(this.contributor).resource)},$getAgent:function(){return this.$client.getAgent(this.$getAgentUrl()||this.$getAgentId())}}},{"./../FamilySearch":1,"./../utils":47}],5:[function(a){var b=a("./../FamilySearch"),c=a("./../utils"),d=c.maybe,e=b.Change=function(a,c){b.BaseClass.call(this,a,c)};b.prototype.createChange=function(a){return new e(this,a)},e.prototype={constructor:e,$getAgentName:function(){return d(d(this.contributors)[0]).name},$getChangeReason:function(){return d(d(this.changeInfo)[0]).reason},$getAgentUrl:function(){return this.$helpers.removeAccessToken(d(d(this.links).agent).href)},$getAgent:function(){return this.$client.getAgent(this.$getAgentUrl())},$restore:function(a){return this.$client.changeHistory.restoreChange(this.id,a)}}},{"./../FamilySearch":1,"./../utils":47}],6:[function(a){var b=a("../FamilySearch"),c=a("../relationshipHelpers"),d=a("../utils"),e=d.maybe,f=b.ChildAndParents=function(a,c){b.BaseClass.call(this,a,c),c&&(c.$father&&(this.$setFather(c.$father),delete this.$father),c.$mother&&(this.$setMother(c.$mother),delete this.$mother),c.$child&&(this.$setChild(c.$child),delete this.$child),c.fatherFacts&&d.forEach(this.fatherFacts,function(c,d){c instanceof b.Fact||(this.fatherFacts[d]=a.createFact(c))},this),c.motherFacts&&d.forEach(this.motherFacts,function(c,d){c instanceof b.Fact||(this.motherFacts[d]=a.createFact(c))},this))};b.prototype.createChildAndParents=function(a){return new f(this,a)},f.prototype={constructor:f,$getChildAndParentsUrl:function(){return this.$helpers.removeAccessToken(e(e(this.links).relationship).href)},$getFatherFacts:function(){return this.fatherFacts||[]},$getMotherFacts:function(){return this.motherFacts||[]},$getFatherId:function(){return e(this.father).resourceId},$getFatherUrl:function(){return this.$helpers.removeAccessToken(e(this.father).resource)},$getFather:function(){return this.$client.getPerson(this.$getFatherUrl()||this.$getFatherId())},$getMotherId:function(){return e(this.mother).resourceId},$getMotherUrl:function(){return this.$helpers.removeAccessToken(e(this.mother).resource)},$getMother:function(){return this.$client.getPerson(this.$getMotherUrl()||this.$getMotherId())},$getChildId:function(){return e(this.child).resourceId},$getChildUrl:function(){return this.$helpers.removeAccessToken(e(this.child).resource)},$getChild:function(){return this.$client.getPerson(this.$getChildUrl()||this.$getChildId())},$getNotes:function(){return this.$client.getChildAndParentsNotes(this.$helpers.removeAccessToken(e(e(this.links).notes).href))},$getSourceRefs:function(){return this.$client.getChildAndParentsSourceRefs(this.id)},$getSources:function(){return this.$client.getChildAndParentsSourcesQuery(this.id)},$getChanges:function(){return this.$client.getChildAndParentsChanges(this.$helpers.removeAccessToken(e(this.links["change-history"]).href))},$setFather:function(a){return c.setMember.call(this,"father",a),this.$fatherChanged=!0,this},$setMother:function(a){return c.setMember.call(this,"mother",a),this.$motherChanged=!0,this},$setChild:function(a){return c.setMember.call(this,"child",a),this},$deleteFather:function(a){return c.deleteMember.call(this,"father",a),this},$deleteMother:function(a){return c.deleteMember.call(this,"mother",a),this},$setFatherFacts:function(a,b){return c.setFacts.call(this,"fatherFacts",a,b),this},$addFatherFact:function(a){return c.addFact.call(this,"fatherFacts",a),this},$deleteFatherFact:function(a,b){return c.deleteFact.call(this,"fatherFacts",a,b),this},$setMotherFacts:function(a,b){return c.setFacts.call(this,"motherFacts",a,b),this},$addMotherFact:function(a){return c.addFact.call(this,"motherFacts",a),this},$deleteMotherFact:function(a,b){return c.deleteFact.call(this,"motherFacts",a,b),this},$save:function(a,b,e){var f=this.$client.createChildAndParents(),g=!1,h=this.id,i=this;(!this.id||this.$fatherChanged)&&(f.father=this.father,g=!0),(!this.id||this.$motherChanged)&&(f.mother=this.mother,g=!0),this.id||(f.child=this.child,g=!0),a&&(f.attribution=i.$client.createAttribution(a)),d.forEach(["fatherFacts","motherFacts"],function(a){d.forEach(i[a],function(b){h&&b.id&&!b.$changed||(c.addFact.call(f,a,b),g=!0)})});var j=[];g&&j.push(i.$helpers.chainHttpPromises(h?i.$plumbing.getUrl("child-and-parents-relationship-template",null,{caprid:h}):i.$plumbing.getUrl("relationships"),function(a){return d.forEach(["father","mother","child"],function(a){f[a]&&!f[a].resource&&f[a].resourceId&&(f[a].resource=f[a].resourceId)}),i.$plumbing.post(a,{childAndParentsRelationships:[f]},{"Content-Type":"application/x-fs-v1+json"},e,i.$helpers.getResponseEntityId)})),d.forEach(["father","mother"],function(b){if(i.id&&i.$deletedMembers&&i.$deletedMembers.hasOwnProperty(b)&&!i[b]){var c=i.$deletedMembers[b]||a;j.push(i.$helpers.chainHttpPromises(i.$plumbing.getUrl("child-and-parents-relationship-parent-template",null,{caprid:h,role:b}),function(a){var b={"Content-Type":"application/x-fs-v1+json"};return c&&(b["X-Reason"]=c),i.$plumbing.del(a,b,e)}))}}),h&&i.$deletedFacts&&d.forEach(i.$deletedFacts,function(b,c){b=b||a;var d={"Content-Type":"application/x-fs-v1+json"};b&&(d["X-Reason"]=b),j.push(i.$plumbing.del(c,d,e))});var k=i.$helpers.promiseAll(j).then(function(a){var c=h?h:a[0];return i.$helpers.extendHttpPromise(k,j[0]),b?i.$client.getChildAndParents(c,{},e).then(function(a){return d.deletePropertiesPartial(i,d.appFieldRejector),d.extend(i,a.getRelationship()),c}):c});return k},$delete:function(a,b){return this.$client.deleteChildAndParents(this.$getChildAndParentsUrl()||this.id,a,b)}}},{"../FamilySearch":1,"../relationshipHelpers":46,"../utils":47}],7:[function(a){var b=a("./../FamilySearch"),c=a("./../utils"),d=c.maybe,e=b.Collection=function(a,c){b.BaseClass.call(this,a,c),c&&c.attribution&&(this.attribution=a.createAttribution(c.attribution))};b.prototype.createCollection=function(a){return new e(this,a)},e.prototype={constructor:e,$getCollectionUrl:function(){return this.$helpers.removeAccessToken(d(d(this.links).self).href)},$getSourceDescriptions:function(a){return this.$client.getCollectionSourceDescriptions(this.$helpers.removeAccessToken(this.links["source-descriptions"].href),a)},$save:function(a,b){var d=this,e=d.$helpers.chainHttpPromises(d.id?d.$plumbing.getUrl("user-collection-template",null,{udcid:d.id}):d.$plumbing.getUrl("user-collections"),function(a){return d.$plumbing.post(a,{collections:[d]},{},b,function(a,b){return d.id||b.getResponseHeader("X-ENTITY-ID")})}),f=e.then(function(g){return d.$helpers.extendHttpPromise(f,e),a?d.$client.getCollection(g,{},b).then(function(a){return c.deletePropertiesPartial(d,c.appFieldRejector),c.extend(d,a.getCollection()),g}):g});return f},$delete:function(a){return this.$client.deleteCollection(this.$getCollectionUrl()||this.id,a)}}},{"./../FamilySearch":1,"./../utils":47}],8:[function(a){var b=a("./../FamilySearch"),c=a("./../utils"),d=c.maybe,e=b.Comment=function(a,c){b.BaseClass.call(this,a,c)};b.prototype.createComment=function(a){return new e(this,a)},e.prototype={constructor:e,$getCommentUrl:function(){return this.$helpers.removeAccessToken(d(d(this.links).comment).href)},$getAgentId:function(){return d(this.contributor).resourceId},$getAgentUrl:function(){return this.$helpers.removeAccessToken(d(this.contributor).resource)},$getAgent:function(){return this.$client.getAgent(this.$getAgentUrl()||this.$getAgentId())},$save:function(a,b){var c=this,d=this.$memoryId?"memory-comments-template":"discussion-comments-template";return c.$helpers.chainHttpPromises(c.$plumbing.getUrl(d,null,{did:c.$discussionId,mid:c.$memoryId}),function(a){var d={discussions:[{comments:[c]}]};return c.$plumbing.post(a,d,{"Content-Type":"application/x-fs-v1+json"},b,function(a,b){return c.id||(c.id=b.getResponseHeader("X-ENTITY-ID")),c.$getCommentUrl()||(c.links={comment:{href:b.getResponseHeader("Location")}}),c.id})})},$delete:function(a,b){return this.$discussionId?this.$client.deleteDiscussionComment(this.$getCommentUrl()||this.$discussionId,this.id,a,b):this.$client.deleteMemoryComment(this.$getCommentUrl()||this.$memoryId,this.id,a,b)}}},{"./../FamilySearch":1,"./../utils":47}],9:[function(a){var b=a("../FamilySearch"),c=a("../relationshipHelpers"),d=a("../utils"),e=d.maybe,f=b.Couple=function(a,c){b.BaseClass.call(this,a,c),c&&(c.$husband&&this.$setHusband(c.$husband),c.$wife&&this.$setWife(c.$wife),c.facts&&d.forEach(this.facts,function(c,d){c instanceof b.Fact||(this.facts[d]=a.createFact(c))},this))};b.prototype.createCouple=function(a){return new f(this,a)},f.prototype={constructor:f,$getCoupleUrl:function(){return this.$helpers.removeAccessToken(e(e(this.links).relationship).href)},$getFacts:function(){return this.facts||[]},$getMarriageFact:function(){return d.find(this.facts,{type:"http://gedcomx.org/Marriage"})},$getHusbandId:function(){return e(this.person1).resourceId},$getHusbandUrl:function(){return this.$helpers.removeAccessToken(e(this.person1).resource)},$getHusband:function(){return this.$client.getPerson(this.$getHusbandUrl()||this.$getHusbandId())},$getWifeId:function(){return e(this.person2).resourceId},$getWifeUrl:function(){return this.$helpers.removeAccessToken(e(this.person2).resource)},$getWife:function(){return this.$client.getPerson(this.$getWifeUrl()||this.$getWifeId())},$getSpouseId:function(a){return e(this.person1).resourceId===a?e(this.person2).resourceId:e(this.person1).resourceId},$getSpouseUrl:function(a){return this.$helpers.removeAccessToken(e(this.person1).resourceId===a?e(this.person2).resource:e(this.person1).resource)},$getSpouse:function(a){return this.$client.getPerson(this.$getSpouseUrl(a)||this.$getSpouseId(a))},$getNotes:function(){return this.$client.getCoupleNotes(this.$helpers.removeAccessToken(e(e(this.links).notes).href))},$getSourceRefs:function(){return this.$client.getCoupleSourceRefs(this.id)},$getSources:function(){return this.$client.getCoupleSourcesQuery(this.id)},$getChanges:function(){return this.$client.getCoupleChanges(this.$helpers.removeAccessToken(e(this.links["change-history"]).href))},$setHusband:function(a){return c.setMember.call(this,"person1",a),this.$husbandChanged=!0,this},$setWife:function(a){return c.setMember.call(this,"person2",a),this.$wifeChanged=!0,this},$setFacts:function(a,b){return c.setFacts.call(this,"facts",a,b),this},$addFact:function(a){return c.addFact.call(this,"facts",a),this},$deleteFact:function(a,b){return c.deleteFact.call(this,"facts",a,b),this},$save:function(a,b,e){var f=this.$client.createCouple(),g=!1,h=this.id,i=this;(!this.id||this.$husbandChanged||this.$wifeChanged)&&(f.person1=this.person1,f.person2=this.person2,g=!0),a&&(f.attribution=i.$client.createAttribution(a)),d.forEach(this.facts,function(a){h&&a.id&&!a.$changed||(c.addFact.call(f,"facts",a),g=!0)});var j=[];g&&(h||(f.type="http://gedcomx.org/Couple"),j.push(i.$helpers.chainHttpPromises(h?i.$plumbing.getUrl("couple-relationship-template",null,{crid:h}):i.$plumbing.getUrl("relationships"),function(a){return d.forEach(["person1","person2"],function(a){f[a]&&!f[a].resource&&f[a].resourceId&&(f[a].resource=f[a].resourceId)}),i.$plumbing.post(a,{relationships:[f]},{},e,i.$helpers.getResponseEntityId)}))),h&&this.$deletedFacts&&d.forEach(this.$deletedFacts,function(b,c){b=b||a,j.push(i.$plumbing.del(c,b?{"X-Reason":b}:{},e))});var k=this,l=i.$helpers.promiseAll(j).then(function(a){var c=h?h:a[0];return i.$helpers.extendHttpPromise(l,j[0]),b?i.$client.getCouple(c,{},e).then(function(a){return d.deletePropertiesPartial(k,d.appFieldRejector),d.extend(k,a.getRelationship()),c}):c});return l},$delete:function(a,b){return this.$client.deleteCouple(this.$getCoupleUrl()||this.id,a,b)}}},{"../FamilySearch":1,"../relationshipHelpers":46,"../utils":47}],10:[function(a){var b=a("./../FamilySearch"),c=function(a,b){var c,d="",e="",f="",g="",h="+",i=0;"about"===a[i]?(b||(d="A"),i++):"before"===a[i]?(b||(d="A/"),i++):"after"===a[i]&&(b||(d="A",e="/"),i++),a[i].length<=2&&(f=(1===a[i].length?"0":"")+a[i],i++);var j=["january","february","march","april","may","june","july","august","september","october","november","december"].indexOf(a[i])+1;return j>0&&(g=(10>j?"0":"")+j.toString(),i++),c=a[i],i++,i<a.length&&"bc"===a[i]&&(h="-"),d+h+c+(g?"-":"")+g+(f?"-":"")+f+e},d=b.Date=function(a,c){b.BaseClass.call(this,a,c)};b.prototype.createDate=function(a){return new d(this,a)},d.prototype={constructor:d,$getFormalDate:function(){var a="";if(this.normalized){var b=this.normalized.trim().toLowerCase().split(" "),d=b.indexOf("/");d>=0&&(b=b.slice(0,d)),"from"===b[0]?(d=b.indexOf("to"),a=c(b.slice(1,d),!0)+"/"+c(b.slice(d+1),!0)):a=c(b,!1)}return a}}},{"./../FamilySearch":1}],11:[function(a){var b=a("./../FamilySearch"),c=a("./../utils"),d=c.maybe,e=b.Discussion=function(a,c){b.BaseClass.call(this,a,c)};b.prototype.createDiscussion=function(a){return new e(this,a)},e.prototype={constructor:e,$getDiscussionUrl:function(){return this.$helpers.removeAccessToken(d(d(this.links).discussion).href)},$getCommentsUrl:function(){return this.$helpers.removeAccessToken(d(d(this.links).comments).href)},$getComments:function(){return this.$client.getDiscussionComments(this.$getCommentsUrl())},$getAgentId:function(){return d(this.contributor).resourceId},$getAgentUrl:function(){return this.$helpers.removeAccessToken(d(this.contributor).resource)},$getAgent:function(){return this.$client.getAgent(this.$getAgentUrl()||this.$getAgentId())},$save:function(a,b,d){var e=this,f=e.$helpers.chainHttpPromises(e.id?e.$plumbing.getUrl("discussion-template",null,{did:e.id}):e.$plumbing.getUrl("discussions"),function(a){return e.$plumbing.post(a,{discussions:[e]},{"Content-Type":"application/x-fs-v1+json"},d,function(a,b){return e.id||b.getResponseHeader("X-ENTITY-ID")})}),g=f.then(function(a){return e.$helpers.extendHttpPromise(g,f),b?e.$client.getDiscussion(a,{},d).then(function(b){return c.deletePropertiesPartial(e,c.appFieldRejector),c.extend(e,b.getDiscussion()),a}):a});return g},$delete:function(a,b){return this.$client.deleteDiscussion(this.$getDiscussionUrl()||this.id,a,b)}}},{"./../FamilySearch":1,"./../utils":47}],12:[function(a){var b=a("./../FamilySearch"),c=a("./../utils"),d=c.maybe,e=b.DiscussionRef=function(a,c){b.BaseClass.call(this,a,c),c&&c.discussion&&this.$setDiscussion(c.discussion)};b.prototype.createDiscussionRef=function(a){return new e(this,a)},e.prototype={constructor:e,$getDiscussionRefUrl:function(){return this.$helpers.removeAccessToken(d(d(this.links)["discussion-reference"]).href)},$getDiscussionUrl:function(){return this.$helpers.removeAccessToken(this.resource)},$getDiscussion:function(){return this.$client.getDiscussion(this.$getDiscussionUrl()||this.resourceId)},$setDiscussion:function(a){return a instanceof b.Discussion?(this.resource=a.$getDiscussionUrl(),this.resourceId=a.id):this.$helpers.isAbsoluteUrl(a)?this.resource=this.$helpers.removeAccessToken(a):this.resourceId=a,this},$save:function(a,b){var c=this;return c.$helpers.chainHttpPromises(c.$plumbing.getUrl("person-discussion-references-template",null,{pid:c.$personId}),function(d){!c.resource&&c.resourceId&&(c.resource=c.resourceId);var e={persons:[{id:c.$personId,"discussion-references":[{resource:c.resource}]}]};a&&(e.persons[0].attribution=c.$client.createAttribution(a));var f={"Content-Type":"application/x-fs-v1+json"};return c.$plumbing.post(d,e,f,b,function(a,b){return c.$getDiscussionRefUrl()||(c.links={"discussion-reference":{href:b.getResponseHeader("Location"),title:"Discussion Reference"}}),c.$getDiscussionRefUrl()})})},$delete:function(a,b){return this.$client.deleteDiscussionRef(this.$getDiscussionRefUrl()||this.$personId,this.id,a,b)}}},{"./../FamilySearch":1,"./../utils":47}],13:[function(a){var b=a("./../FamilySearch"),c=a("./../utils"),d=c.maybe,e=b.Fact=function(a,c){b.BaseClass.call(this,a,c),c&&(c.$date&&(this.$setDate(c.$date),delete this.$date),c.$formalDate&&(this.$setFormalDate(c.$formalDate),delete this.$formalDate),c.$place&&(this.$setPlace(c.$place),delete this.$place),c.$normalizedPlace&&(this.$setNormalizedPlace(c.$normalizedPlace),delete this.$normalizedPlace),c.$changeMessage&&(this.$setChangeMessage(c.$changeMessage),delete this.$changeMessage),!c.attribution||c.attribution instanceof b.Attribution||(this.attribution=a.createAttribution(c.attribution)))};b.prototype.createFact=function(a){return new e(this,a)},e.prototype={constructor:e,$getDate:function(){return d(this.date).original},$getNormalizedDate:function(){return d(d(d(this.date).normalized)[0]).value},$getFormalDate:function(){return d(this.date).formal},$getPlace:function(){return d(this.place).original},$getNormalizedPlace:function(){return d(d(d(this.place).normalized)[0]).value},$getNormalizedPlaceId:function(){var a=d(this.place).description;return a&&"#"===a.charAt(0)?a.substr(1):""},$isCustomNonEvent:function(){if(this.qualifiers){var a=c.find(this.qualifiers,{name:"http://familysearch.org/v1/Event"});return!!a&&"false"===a.value}return!1},$setType:function(a){return this.$changed=!0,this.type=a,this},$setCustomNonEvent:function(a){var b;return a?(this.qualifiers||(this.qualifiers=[]),b=c.findIndex(this.qualifiers,{name:"http://familysearch.org/v1/Event"}),0>b&&(b=this.qualifiers.push({name:"http://familysearch.org/v1/Event"})-1),this.qualifiers[b].value="false"):this.qualifiers&&(b=c.findIndex(this.qualifiers,{name:"http://familysearch.org/v1/Event"}),b>=0&&this.qualifiers.splice(b,1),0===this.qualifiers.length&&delete this.qualifiers),this.$changed=!0,this},$setDate:function(a){this.$changed=!0;var d;return c.isString(a)?d=a:a instanceof b.Date?(d=a.original,this.$setFormalDate(a.$getFormalDate()),this.$setNormalizedDate(a.normalized)):c.isObject(a)&&(d=a.$original,this.$setFormalDate(a.$formal),this.$setNormalizedDate(a.$normalized)),d?(this.date||(this.date={}),this.date.original=d):delete this.date,this},$setFormalDate:function(a){return this.$changed=!0,a?(this.date||(this.date={}),this.date.formal=a):this.date&&delete this.date.formal,this},$setNormalizedDate:function(a){return this.$changed=!0,a?(this.date||(this.date={}),this.date.normalized=[{value:a}]):this.date&&delete this.date.normalized,this},$setPlace:function(a){this.$changed=!0;var d;return c.isString(a)||null==a?d=a:a instanceof b.Place?(d=a.original,this.$setNormalizedPlace(a.$getNormalizedPlace())):c.isObject(a)&&(d=a.$original,this.$setNormalizedPlace(a.$normalized)),d?(this.place||(this.place={}),this.place.original=d):delete this.place,this},$setNormalizedPlace:function(a){return this.$changed=!0,a?(this.place||(this.place={}),this.place.normalized=[{value:a}]):this.place&&delete this.place.normalized,this},$setChangeMessage:function(a){return this.attribution=this.$client.createAttribution(a),this}}},{"./../FamilySearch":1,"./../utils":47}],14:[function(a){var b=a("./../FamilySearch"),c=a("./../utils"),d=c.maybe,e=b.Memory=function(a,c){b.BaseClass.call(this,a,c)};b.prototype.createMemory=function(a){return new e(this,a)},e.prototype={constructor:e,$getTitle:function(){return d(d(this.titles)[0]).value},$getDescription:function(){return d(d(this.description)[0]).value},$getIconUrl:function(){return this.$helpers.appendAccessToken(d(d(this.links)["image-icon"]).href)},$getThumbnailUrl:function(){return this.$helpers.appendAccessToken(d(d(this.links)["image-thumbnail"]).href)},$getImageUrl:function(){return this.$helpers.appendAccessToken(d(d(this.links).image).href)},$getMemoryArtifactUrl:function(){return this.$helpers.appendAccessToken(this.$helpers.removeAccessToken(this.about))},$getMemoryUrl:function(){return this.$helpers.removeAccessToken(d(d(this.links).description).href)},$getArtifactFilename:function(){return d(d(this.artifactMetadata)[0]).filename},$getArtifactType:function(){return d(d(this.artifactMetadata)[0]).artifactType},$getArtifactHeight:function(){return d(d(this.artifactMetadata)[0]).height},$getArtifactWidth:function(){return d(d(this.artifactMetadata)[0]).width},$getCommentsUrl:function(){return this.$helpers.removeAccessToken(d(d(this.links).comments).href)},$getComments:function(){return this.$client.getMemoryComments(this.$getCommentsUrl()||this.id)},$setTitle:function(a){return this.titles=[{value:a}],this},$setDescription:function(a){return this.description=[{value:a}],this},$setArtifactFilename:function(a){return c.isArray(this.artifactMetadata)&&this.artifactMetadata.length||(this.artifactMetadata=[{}]),this.artifactMetadata[0].filename=a,this},$save:function(a,b,d){var e=this,f=e.$helpers.chainHttpPromises(e.id?e.$plumbing.getUrl("memory-template",null,{mid:e.id}):e.$plumbing.getUrl("memories"),function(a){if(e.id)return e.$plumbing.post(a,{sourceDescriptions:[e]},{},d,function(){return e.id});var b={};return e.$getTitle()&&(b.title=e.$getTitle()),e.$getDescription()&&(b.description=e.$getDescription()),e.$getArtifactFilename()&&(b.filename=e.$getArtifactFilename()),e.$plumbing.post(e.$helpers.appendQueryParameters(a,b),e.$data,{"Content-Type":c.isString(e.$data)?"text/plain":"multipart/form-data"},d,e.$helpers.getResponseEntityId)}),g=f.then(function(a){return e.$helpers.extendHttpPromise(g,f),b?e.$client.getMemory(a,{},d).then(function(b){return c.deletePropertiesPartial(e,c.appFieldRejector),c.extend(e,b.getMemory()),a}):a});return g},$delete:function(a,b){return this.$client.deleteMemory(this.$getMemoryUrl()||this.id,a,b)}}},{"./../FamilySearch":1,"./../utils":47}],15:[function(a){var b=a("./../FamilySearch"),c=a("./../utils"),d=c.maybe,e=b.MemoryArtifactRef=function(a,c){b.BaseClass.call(this,a,c)};b.prototype.createMemoryArtifactRef=function(a){return new e(this,a)},e.prototype={constructor:e,$getQualifierName:function(){return d(d(this.qualifiers)[0]).name},$getQualifierValue:function(){return d(d(this.qualifiers)[0]).value},$setQualifierName:function(a){return c.isArray(this.qualifiers)&&this.qualifiers.length||(this.qualifiers=[{}]),this.qualifiers[0].name=a,this},$setQualifierValue:function(a){return c.isArray(this.qualifiers)&&this.qualifiers.length||(this.qualifiers=[{}]),this.qualifiers[0].value=a,this}}},{"./../FamilySearch":1,"./../utils":47}],16:[function(a){var b=a("./../FamilySearch"),c=a("./../utils"),d=c.maybe,e=b.MemoryPersona=function(a,c){b.BaseClass.call(this,a,c)};b.prototype.createMemoryPersona=function(a){return new e(this,a)},e.prototype={constructor:e,$getMemoryPersonaUrl:function(){return this.$helpers.removeAccessToken(d(d(this.links).persona).href)},$getMemoryArtifactRef:function(){return d(this.media)[0]},$getName:function(){return d(this.names)[0]},$getDisplayName:function(){return d(this.display).name},$getMemoryUrl:function(){return this.$helpers.removeAccessToken(d(this.$getMemoryArtifactRef()).description)},$getMemory:function(){return this.$client.getMemory(this.$getMemoryUrl()||this.$memoryId)},$setName:function(a){return a instanceof b.Name||(a=this.$client.createName(a)),this.names=[a],this},$setMemoryArtifactRef:function(a){return this.media=[a],this},$save:function(a,b,d){var e=this,f=e.$helpers.chainHttpPromises(e.$plumbing.getUrl(e.id?"memory-persona-template":"memory-personas-template",null,{mid:e.$memoryId,pid:e.id}),function(a){if(!e.$getMemoryArtifactRef()){var b=e.$helpers.getUrlFromDiscoveryResource(e.$client.settings.discoveryResource,"memory-template",{mid:e.$memoryId});e.$setMemoryArtifactRef(e.$client.createMemoryArtifactRef({description:b}))}return e.$plumbing.post(a,{persons:[e]},{},d,function(a,b){return e.$getMemoryPersonaUrl()||e.$helpers.removeAccessToken(b.getResponseHeader("Location"))})}),g=f.then(function(a){return e.$helpers.extendHttpPromise(g,f),b?e.$client.getMemoryPersona(a,null,{},d).then(function(b){return c.deletePropertiesPartial(e,c.appFieldRejector),c.extend(e,b.getMemoryPersona()),a}):a});return g},$delete:function(a,b){return this.$client.deleteMemoryPersona(this.$getMemoryPersonaUrl()||this.$memoryId,this.id,a,b)}}},{"./../FamilySearch":1,"./../utils":47}],17:[function(a){var b=a("./../FamilySearch"),c=a("./../utils"),d=c.maybe,e=b.MemoryPersonaRef=function(a,c){b.BaseClass.call(this,a,c),c&&c.$memoryPersona&&this.$setMemoryPersona(c.$memoryPersona)};b.prototype.createMemoryPersonaRef=function(a){return new e(this,a)},e.prototype={constructor:e,$getMemoryPersonaRefUrl:function(){return this.$helpers.removeAccessToken(d(d(this.links)["evidence-reference"]).href)},$getMemoryPersonaUrl:function(){return this.$helpers.removeAccessToken(this.resource)},$getMemoryPersona:function(){return this.$client.getMemoryPersona(this.$getMemoryPersonaUrl())},$getMemoryUrl:function(){return this.$helpers.removeAccessToken(d(d(this.links).memory).href)},$getMemory:function(){return this.$client.getMemory(this.$getMemoryUrl())},$setMemoryPersona:function(a){return a instanceof b.MemoryPersona&&(a=a.$getMemoryPersonaUrl()),this.resource=this.$helpers.removeAccessToken(a),this},$save:function(a,b){var c=this;return c.$helpers.chainHttpPromises(c.$plumbing.getUrl("person-memory-persona-references-template",null,{pid:c.$personId}),function(a){return c.$plumbing.post(a,{persons:[{evidence:[c]}]},{},b,function(a,b){return c.id||(c.id=b.getResponseHeader("X-ENTITY-ID")),c.$getMemoryPersonaRefUrl()||(c.links={"evidence-reference":{href:b.getResponseHeader("Location")}}),c.$getMemoryPersonaRefUrl();

})})},$delete:function(a,b){return this.$client.deleteMemoryPersonaRef(this.$getMemoryPersonaRefUrl()||this.$personId,this.id,a,b)}}},{"./../FamilySearch":1,"./../utils":47}],18:[function(a){function b(a,b){var c=b||0;for(d.isArray(a.nameForms)||(a.nameForms=[]);c>=a.nameForms.length;)a.nameForms.push({});return a.nameForms[c]}var c=a("./../FamilySearch"),d=a("./../utils"),e=d.maybe,f=c.Name=function(a,b){c.BaseClass.call(this,a,b),b&&(d.isString(b)?this.$setFullText(b):(b.type&&this.$setType(b.type),b.$givenName&&(this.$setGivenName(b.$givenName),delete this.$givenName),b.$surname&&(this.$setSurname(b.$surname),delete this.$surname),b.$prefix&&(this.$setPrefix(b.$prefix),delete this.$prefix),b.$suffix&&(this.$setSuffix(b.$suffix),delete this.$suffix),b.$fullText&&(this.$setFullText(b.$fullText),delete this.$fullText),this.$setPreferred(!!b.preferred),b.$changeMessage&&(this.$setChangeMessage(b.$changeMessage),delete this.$changeMessage),!b.attribution||b.attribution instanceof c.Attribution||(this.attribution=a.createAttribution(b.attribution))))};c.prototype.createName=function(a){return new f(this,a)},f.prototype={constructor:f,$getNameFormsCount:function(){return this.nameForms?this.nameForms.length:0},$getNameForm:function(a){return e(this.nameForms)[a||0]},$getFullText:function(a){return e(this.$getNameForm(a)).fullText},$getLang:function(a){return e(this.$getNameForm(a)).lang},$getNamePart:function(a,b){return e(d.find(e(this.$getNameForm(b)).parts,{type:a})).value},$getGivenName:function(a){return this.$getNamePart("http://gedcomx.org/Given",a)},$getSurname:function(a){return this.$getNamePart("http://gedcomx.org/Surname",a)},$getPrefix:function(a){return this.$getNamePart("http://gedcomx.org/Prefix",a)},$getSuffix:function(a){return this.$getNamePart("http://gedcomx.org/Suffix",a)},$setType:function(a){return this.$changed=!0,a?this.type=a:delete this.type,this},$setPreferred:function(a){return this.$changed=!0,this.preferred=a,this},$setFullText:function(a,c){this.$changed=!0;var d=b(this,c);return a?d.fullText=a:delete d.fullText,this},$setNamePart:function(a,c,e){this.$changed=!0;var f=b(this,e);d.isArray(f.parts)||(f.parts=[]);var g=d.find(f.parts,{type:c});return a?(g||(g={type:c},f.parts.push(g)),g.value=a):g&&f.parts.splice(f.parts.indexOf(g),1),this},$setGivenName:function(a,b){return this.$setNamePart(a,"http://gedcomx.org/Given",b)},$setSurname:function(a,b){return this.$setNamePart(a,"http://gedcomx.org/Surname",b)},$setPrefix:function(a,b){return this.$setNamePart(a,"http://gedcomx.org/Prefix",b)},$setSuffix:function(a,b){return this.$setNamePart(a,"http://gedcomx.org/Suffix",b)},$setChangeMessage:function(a){return this.attribution=this.$client.createAttribution(a),this}}},{"./../FamilySearch":1,"./../utils":47}],19:[function(a){var b=a("./../FamilySearch"),c=a("./../utils"),d=c.maybe,e=b.Note=function(a,c){b.BaseClass.call(this,a,c),!this.attribution||this.attribution instanceof b.Attribution||(this.attribution=a.createAttribution(this.attribution))};b.prototype.createNote=function(a){return new e(this,a)},e.prototype={constructor:e,$getNoteUrl:function(){return this.$helpers.removeAccessToken(d(d(this.links).note).href)},$save:function(a,b,d){var e,f,g=this,h={};g.$personId?(e=g.id?"person-note-template":"person-notes-template",f="persons"):g.$coupleId?(e=g.id?"couple-relationship-note-template":"couple-relationship-notes-template",f="relationships"):g.$childAndParentsId&&(e=g.id?"child-and-parents-relationship-note-template":"child-and-parents-relationship-notes-template",f="childAndParentsRelationships",h["Content-Type"]="application/x-fs-v1+json");var i=g.$helpers.chainHttpPromises(g.$plumbing.getUrl(e,null,{pid:g.$personId,crid:g.$coupleId,caprid:g.$childAndParentsId,nid:g.id}),function(b){var c={};return c[f]=[{notes:[g]}],a&&(c[f][0].attribution=g.$client.createAttribution(a)),g.$plumbing.post(b,c,h,d,function(a,b){return{id:g.id||b.getResponseHeader("X-ENTITY-ID"),location:g.$getNoteUrl()||g.$helpers.removeAccessToken(b.getResponseHeader("Location"))}})}),j=i.then(function(a){return g.$helpers.extendHttpPromise(j,i),b?g.$client.getPersonNote(a.location,null,{},d).then(function(b){return c.deletePropertiesPartial(g,c.appFieldRejector),c.extend(g,b.getNote()),a.id}):a.id});return j},$delete:function(a,b){return this.$personId?this.$client.deletePersonNote(this.$getNoteUrl()||this.$personId,this.id,a,b):this.$coupleId?this.$client.deleteCoupleNote(this.$getNoteUrl()||this.$coupleId,this.id,a,b):this.$client.deleteChildAndParentsNote(this.$getNoteUrl()||this.$childAndParentsId,this.id,a,b)}}},{"./../FamilySearch":1,"./../utils":47}],20:[function(a){function b(a){return a?" "+a:""}var c=a("../FamilySearch"),d=a("../utils"),e=d.maybe,f=c.Person=function(a,b){c.BaseClass.call(this,a,b),b&&(b.$gender&&(this.$setGender(b.$gender),delete this.$gender),b.names&&d.forEach(this.names,function(b,d){b instanceof c.Name||(this.names[d]=a.createName(b))},this),b.facts&&d.forEach(this.facts,function(b,d){b instanceof c.Fact||(this.facts[d]=a.createFact(b))},this),!b.attribution||b.attribution instanceof c.Attribution||(this.attribution=a.createAttribution(b.attribution)))};c.prototype.createPerson=function(a){return new f(this,a)},f.prototype={constructor:f,$getFacts:function(a){return(a?d.filter(this.facts,{type:a}):this.facts)||[]},$getFact:function(a){return d.find(this.facts,{type:a})},$getBirth:function(){return this.$getFact("http://gedcomx.org/Birth")},$getBirthDate:function(){var a=this.$getBirth();return a?a.$getDate():""},$getBirthPlace:function(){var a=this.$getBirth();return a?a.$getPlace():""},$getChristening:function(){return this.$getFact("http://gedcomx.org/Christening")},$getChristeningDate:function(){var a=this.$getChristening();return a?a.$getDate():""},$getChristeningPlace:function(){var a=this.$getChristening();return a?a.$getPlace():""},$getDeath:function(){return this.$getFact("http://gedcomx.org/Death")},$getDeathDate:function(){var a=this.$getDeath();return a?a.$getDate():""},$getDeathPlace:function(){var a=this.$getDeath();return a?a.$getPlace():""},$getBurial:function(){return this.$getFact("http://gedcomx.org/Burial")},$getBurialDate:function(){var a=this.$getBurial();return a?a.$getDate():""},$getBurialPlace:function(){var a=this.$getBurial();return a?a.$getPlace():""},$getDisplayBirthDate:function(){return e(this.display).birthDate},$getDisplayBirthPlace:function(){return e(this.display).birthPlace},$getDisplayDeathDate:function(){return e(this.display).deathDate},$getDisplayDeathPlace:function(){return e(this.display).deathPlace},$getDisplayGender:function(){return e(this.display).gender},$getDisplayLifeSpan:function(){return e(this.display).lifespan},$getDisplayName:function(){return e(this.display).name},$getNames:function(a){return(a?d.filter(this.names,{type:a}):this.names)||[]},$getPreferredName:function(){return d.findOrFirst(this.names,{preferred:!0})},$getGivenName:function(){var a=this.$getPreferredName();return a&&(a=a.$getGivenName()),a},$getSurname:function(){var a=this.$getPreferredName();return a&&(a=a.$getSurname()),a},$getPersistentIdentifier:function(){return e(e(this.identifiers)["http://gedcomx.org/Persistent"])[0]},$getPersonUrl:function(){return this.$helpers.removeAccessToken(e(e(this.links).person).href)},$getChanges:function(a){return this.$client.getPersonChanges(this.$helpers.removeAccessToken(this.links["change-history"].href),a)},$getDiscussionRefs:function(){return this.$client.getPersonDiscussionRefs(this.$helpers.removeAccessToken(this.links["discussion-references"].href))},$getMemoryPersonaRefs:function(){return this.$client.getMemoryPersonaRefs(this.$helpers.removeAccessToken(this.links["evidence-references"].href))},$getNotes:function(){return this.$client.getPersonNotes(this.$helpers.removeAccessToken(this.links.notes.href))},$getSourceRefs:function(){return this.$client.getPersonSourceRefs(this.id)},$getSources:function(){return this.$client.getPersonSourcesQuery(this.id)},$getSpouses:function(){return this.$client.getSpouses(this.id)},$getParents:function(){return this.$client.getParents(this.id)},$getChildren:function(){return this.$client.getChildren(this.id)},$getMatches:function(){return this.$client.getPersonMatches(this.id)},$getAncestry:function(a){return this.$client.getAncestry(this.id,a)},$getDescendancy:function(a){return this.$client.getDescendancy(this.id,a)},$getPersonPortraitUrl:function(a){return this.$client.getPersonPortraitUrl(this.id,a)},$setNames:function(a,b){return d.isArray(this.names)&&d.forEach(this.names,function(a){this.$deleteName(a,b)},this),this.names=[],d.forEach(a,function(a){this.$addName(a)},this),this},$addName:function(a){return d.isArray(this.names)||(this.names=[]),a instanceof c.Name||(a=this.$client.createName(a)),this.names.push(a),this},$deleteName:function(a,b){a instanceof c.Name||(a=d.find(this.names,{id:a}));var e=d.indexOf(this.names,a);return e>=0&&(this.$deletedConclusions||(this.$deletedConclusions={}),this.$deletedConclusions[a.id]=b,this.names.splice(e,1)),this},$setFacts:function(a,b){return d.isArray(this.facts)&&d.forEach(this.facts,function(a){this.$deleteFact(a,b)},this),this.facts=[],d.forEach(a,function(a){this.$addFact(a)},this),this},$addFact:function(a){return d.isArray(this.facts)||(this.facts=[]),a instanceof c.Fact||(a=this.$client.createFact(a)),this.facts.push(a),this},$deleteFact:function(a,b){a instanceof c.Fact||(a=d.find(this.facts,{id:a}));var e=d.indexOf(this.facts,a);return e>=0&&(this.$deletedConclusions||(this.$deletedConclusions={}),this.$deletedConclusions[a.id]=b,this.facts.splice(e,1)),this},$setGender:function(a,b){return this.gender||(this.gender={}),this.gender.$changed=!0,this.gender.type=a,b&&(this.gender.attribution=this.$client.createAttribution(b)),this},$save:function(a,c,e){var f=this.$client.createPerson(),g=!1;this.id&&(f.id=this.id),this.id||(this.gender||this.$setGender("http://gedcomx.org/Unknown"),d.isArray(this.names)&&0!==this.names.length||this.$addName({$fullText:"Unknown",$givenName:"Unknown"}),d.find(this.names,{preferred:!0})||this.names[0].$setPreferred(!0),1!==this.names.length||this.names[0].type||this.names[0].$setType("http://gedcomx.org/BirthName"),d.isUndefined(this.living)&&(this.living=!1)),a&&(f.attribution=this.$client.createAttribution(a)),this.id||(f.living=this.living),!this.gender||this.gender.id&&!this.gender.$changed||(f.gender=this.gender,g=!0),d.forEach(this.names,function(a){(!a.id||a.$changed)&&(a.$getFullText()||a.$setFullText((b(a.$getPrefix())+b(a.$getGivenName())+b(a.$getSurname())+b(a.$getSuffix())).trim()),f.$addName(a),g=!0)}),d.forEach(this.facts,function(a){(!a.id||a.$changed)&&(f.$addFact(a),g=!0)});var h=[],i=this;g&&h.push(i.$helpers.chainHttpPromises(f.id?i.$plumbing.getUrl("person-template",null,{pid:f.id}):i.$plumbing.getUrl("persons"),function(a){return i.$plumbing.post(a,{persons:[f]},{},e,i.$helpers.getResponseEntityId)})),this.id&&this.$deletedConclusions&&d.forEach(this.$deletedConclusions,function(b,c){b=b||a,h.push(i.$helpers.chainHttpPromises(i.$plumbing.getUrl("person-conclusion-template",null,{pid:f.id,cid:c}),function(a){return i.$plumbing.del(a,b?{"X-Reason":b}:{},e)}))});var j=this,k=i.$helpers.promiseAll(h).then(function(a){var b=f.id?f.id:a[0];return i.$helpers.extendHttpPromise(k,h[0]),c?i.$client.getPerson(b,{},e).then(function(a){return d.deletePropertiesPartial(j,d.appFieldRejector),d.extend(j,a.getPerson()),b}):b});return k},$delete:function(a,b){return this.$client.deletePerson(this.$getPersonUrl()||this.id,a,b)}}},{"../FamilySearch":1,"../utils":47}],21:[function(a){var b=a("./../FamilySearch"),c=b.Place=function(a,c){b.BaseClass.call(this,a,c)};b.prototype.createPlace=function(a){return new c(this,a)},c.prototype={constructor:c,$getNormalizedPlace:function(){return this.normalized?this.normalized[0]:void 0}}},{"./../FamilySearch":1}],22:[function(a){var b=a("./../FamilySearch"),c=a("./../utils"),d=c.maybe,e=b.SearchResult=function(a,e){b.BaseClass.call(this,a,e),c.forEach(d(d(d(e).content).gedcomx).persons,function(b,c,d){d[c]=a.createPerson(b)})};b.prototype.createSearchResult=function(a){return new e(this,a)},e.prototype={constructor:e,$getPerson:function(a){return c.find(d(d(this.content).gedcomx).persons,{id:a})},$getPrimaryPerson:function(){return this.$getPerson(this.id)},$getFullPrimaryPerson:function(){return this.$client.getPerson(this.id)},$getFatherIds:function(){var a=this.id,b=this;return c.uniq(c.map(c.filter(d(d(this.content).gedcomx).relationships,function(c){return"http://gedcomx.org/ParentChild"===c.type&&c.person2.resourceId===a&&c.person1&&"http://gedcomx.org/Male"===d(b.$getPerson(c.person1.resourceId).gender).type}),function(a){return a.person1.resourceId}))},$getFathers:function(){return c.map(this.$getFatherIds(),this.$getPerson,this)},$getMotherIds:function(){var a=this.id,b=this;return c.uniq(c.map(c.filter(d(d(this.content).gedcomx).relationships,function(c){return"http://gedcomx.org/ParentChild"===c.type&&c.person2.resourceId===a&&c.person1&&"http://gedcomx.org/Male"!==d(b.$getPerson(c.person1.resourceId).gender).type}),function(a){return a.person1.resourceId}))},$getMothers:function(){return c.map(this.$getMotherIds(),this.$getPerson,this)},$getSpouseIds:function(){var a=this.id;return c.uniq(c.map(c.filter(d(d(this.content).gedcomx).relationships,function(b){return"http://gedcomx.org/Couple"===b.type&&(b.person1.resourceId===a||b.person2.resourceId===a)}),function(b){return b.person1.resourceId===a?b.person2.resourceId:b.person1.resourceId}))},$getSpouses:function(){return c.map(this.$getSpouseIds(),this.$getPerson,this)},$getChildIds:function(){var a=this.id;return c.uniq(c.map(c.filter(d(d(this.content).gedcomx).relationships,function(b){return"http://gedcomx.org/ParentChild"===b.type&&b.person1.resourceId===a&&b.person2}),function(a){return a.person2.resourceId}))},$getChildren:function(){return c.map(this.$getChildIds(),this.$getPerson,this)}}},{"./../FamilySearch":1,"./../utils":47}],23:[function(a){var b=a("./../FamilySearch"),c=a("./../utils"),d=c.maybe,e=b.SourceDescription=function(a,c){b.BaseClass.call(this,a,c),c&&(c.$citation&&this.$setCitation(c.$citation),c.$title&&this.$setTitle(c.$title),c.$text&&this.$setText(c.$text),!c.attribution||c.attribution instanceof b.Attribution||(this.attribution=a.createAttribution(c.attribution)))};b.prototype.createSourceDescription=function(a){return new e(this,a)},e.prototype={constructor:e,$getCitation:function(){return d(d(this.citations)[0]).value},$getTitle:function(){return d(d(this.titles)[0]).value},$getText:function(){return d(d(this.notes)[0]).text},$getSourceDescriptionUrl:function(){return this.$helpers.removeAccessToken(d(d(this.links).description).href)},$getSourceRefsQuery:function(){return this.$client.getSourceRefsQuery(this.id)},$setCitation:function(a){return this.citations=[{value:a}],this},$setTitle:function(a){return this.titles=[{value:a}],this},$setText:function(a){return this.notes=[{text:a}],this},$save:function(a,b,d){var e=this;a&&(e.attribution=e.$client.createAttribution(a));var f=e.$helpers.chainHttpPromises(e.id?e.$plumbing.getUrl("source-description-template",null,{sdid:e.id}):e.$plumbing.getUrl("source-descriptions"),function(a){return e.$plumbing.post(a,{sourceDescriptions:[e]},{},d,function(a,b){return e.id||b.getResponseHeader("X-ENTITY-ID")})}),g=f.then(function(a){return e.$helpers.extendHttpPromise(g,f),b?e.$client.getSourceDescription(a,{},d).then(function(b){return c.deletePropertiesPartial(e,c.appFieldRejector),c.extend(e,b.getSourceDescription()),a}):a});return g},$delete:function(a,b){return this.$client.deleteSourceDescription(this.id,a,b)}}},{"./../FamilySearch":1,"./../utils":47}],24:[function(a){var b=a("./../FamilySearch"),c=a("./../utils"),d=c.maybe,e=b.SourceRef=function(a,c){b.BaseClass.call(this,a,c),c&&(this.$personId=c.$personId,this.$coupleId=c.$coupleId,this.$childAndParentsId=c.$childAndParentsId,c.$sourceDescription&&this.$setSourceDescription(c.$sourceDescription),c.$tags&&this.$setTags(c.$tags),!c.attribution||c.attribution instanceof b.Attribution||(this.attribution=a.createAttribution(c.attribution)))};b.prototype.createSourceRef=function(a){return new e(this,a)},e.prototype={constructor:e,$getSourceRefUrl:function(){return this.$helpers.removeAccessToken(d(d(this.links)["source-reference"]).href)},$getSourceDescriptionUrl:function(){return this.$helpers.removeAccessToken(this.description)},$getSourceDescription:function(){return this.$client.getSourceDescription(this.$getSourceDescriptionUrl())},$getTags:function(){return c.map(this.tags,function(a){return a.resource})},$setSourceDescription:function(a){return a instanceof b.SourceDescription?(this.$sourceDescriptionId=a.id,this.description=a.$getSourceDescriptionUrl()):this.$helpers.isAbsoluteUrl(a)?(delete this.$sourceDescriptionId,this.description=this.$sourceDescriptionUrl):(this.$sourceDescriptionId=a,delete this.description),this},$setTags:function(a){return this.tags=c.map(a,function(a){return{resource:a}}),this},$addTag:function(a){return c.isArray(this.tags)||(this.tags=[]),this.tags.push({resource:a}),this},$removeTag:function(a){return a=c.find(this.tags,{resource:a}),a&&this.tags.splice(c.indexOf(this.tags,a),1),this},$save:function(a,b){var c=this;a&&(c.attribution=c.$client.createAttribution(a));var d,e,f={};return c.$personId?(d="person-source-references-template",e="persons"):c.$coupleId?(d="couple-relationship-source-references-template",e="relationships"):c.$childAndParentsId&&(d="child-and-parents-relationship-source-references-template",d="child-and-parents-relationship-source-references-template",e="childAndParentsRelationships",f["Content-Type"]="application/x-fs-v1+json"),c.$helpers.chainHttpPromises(c.$plumbing.getUrl(d,null,{pid:c.$personId,crid:c.$coupleId,caprid:c.$childAndParentsId,srid:c.id}),function(a){!c.description&&c.$sourceDescriptionId&&(c.description=c.$helpers.getUrlFromDiscoveryResource(c.$client.settings.discoveryResource,"source-description-template",{sdid:c.$sourceDescriptionId})),c.description=c.$helpers.removeAccessToken(c.description);var d={};return d[e]=[{sources:[c]}],c.$plumbing.post(a,d,f,b,function(a,b){return c.id||(c.id=b.getResponseHeader("X-ENTITY-ID")),c.$getSourceRefUrl()||(c.links={"source-reference":{href:c.$helpers.removeAccessToken(b.getResponseHeader("Location"))}}),c.id})})},$delete:function(a,b){return this.$personId?this.$client.deletePersonSourceRef(this.$getSourceRefUrl()||this.$personID,this.id,a,b):this.$coupleId?this.$client.deleteCoupleSourceRef(this.$getSourceRefUrl()||this.$coupleId,this.id,a,b):this.$client.deleteChildAndParentsSourceRef(this.$getSourceRefUrl()||this.$childAndParentsId,this.id,a,b)}}},{"./../FamilySearch":1,"./../utils":47}],25:[function(a){var b=a("../FamilySearch"),c=b.User=function(a,c){b.BaseClass.call(this,a,c)};b.prototype.createUser=function(a){return new c(this,a)},c.prototype={constructor:c}},{"../FamilySearch":1}],26:[function(a,b){b.exports={clientId:null,environment:null,httpWrapper:null,deferredWrapper:null,setTimeout:null,clearTimeout:null,redirectUri:null,autoSignin:!1,autoExpire:!1,accessToken:null,saveAccessToken:!1,logging:!1,accessTokenCookie:"FS_ACCESS_TOKEN",authCodePollDelay:50,defaultThrottleRetryAfter:500,maxHttpRequestRetries:2,maxAccessTokenInactivityTime:354e4,maxAccessTokenCreationTime:8634e4,apiServer:{sandbox:"https://sandbox.familysearch.org",staging:"https://stage.familysearch.org",beta:"https://beta.familysearch.org",production:"https://familysearch.org"},oauthServer:{sandbox:"https://sandbox.familysearch.org/cis-web/oauth2/v3",staging:"https://identbeta.familysearch.org/cis-web/oauth2/v3",beta:"https://identbeta.familysearch.org/cis-web/oauth2/v3",production:"https://ident.familysearch.org/cis-web/oauth2/v3"},authoritiesServer:{sandbox:"https://sandbox.familysearch.org",staging:"https://stage.familysearch.org",beta:"https://apibeta.familysearch.org",production:"https://api.familysearch.org"},discoveryUrl:"/.well-known/app-meta"}},{}],27:[function(a,b){var c=a("./utils"),d=c.forEach,e=function(a){this.settings=a.settings,this.accessTokenInactiveTimer=null,this.accessTokenCreationTimer=null};e.prototype.getAbsoluteUrl=function(a,b){return this.isAbsoluteUrl(b)?b:a+("/"!==b.charAt(0)?"/":"")+b},e.prototype.isOAuthServerUrl=function(a){return 0===a.indexOf(this.settings.oauthServer[this.settings.environment])},e.prototype.getAPIServerUrl=function(a){return this.getAbsoluteUrl(this.settings.apiServer[this.settings.environment],a)},e.prototype.getAuthoritiesServerUrl=function(a){return this.getAbsoluteUrl(this.settings.authoritiesServer[this.settings.environment],a)},e.prototype.appendAccessToken=function(a){if(a){var b=this.decodeQueryString(a);a=this.removeQueryString(a),b.access_token=this.settings.accessToken,a=this.appendQueryParameters(a,b)}return a},e.prototype.log=function(){this.settings.debug&&console.log.apply(null,arguments)},e.prototype.nextTick=function(a){this.settings.setTimeout(function(){a()},0)},e.prototype.refPromise=function(a){if(a&&c.isFunction(a.then))return a;var b=this;return{then:function(c){var d=b.settings.deferredWrapper();return b.nextTick(function(){d.resolve(c(a))}),d.promise}}},e.prototype.promiseAll=function(a){var b=this.settings.deferredWrapper(),e=0,f=c.isArray(a)?[]:{},g=this;return d(a,function(a,c){e++,g.refPromise(a).then(function(a){f.hasOwnProperty(c)||(f[c]=a,--e||b.resolve(f))},function(){f.hasOwnProperty(c)||b.reject.apply(b,arguments)})}),0===e&&b.resolve(f),b.promise},e.prototype.setTimer=function(a,b,c){return c&&this.settings.clearTimeout(c),this.settings.setTimeout(function(){a()},b)},e.prototype.setAccessTokenInactiveTimer=function(a){this.accessTokenInactiveTimer=this.setTimer(this.settings.eraseAccessToken,a,this.accessTokenInactiveTimer)},e.prototype.setAccessTokenCreationTimer=function(a){this.accessTokenCreationTimer=this.setTimer(this.settings.eraseAccessToken,a,this.accessTokenCreationTimer)},e.prototype.clearAccessTokenTimers=function(){this.settings.clearTimeout(this.accessTokenInactiveTimer),this.accessTokenInactiveTimer=null,this.settings.clearTimeout(this.accessTokenCreationTimer),this.accessTokenCreationTimer=null},e.prototype.getAccessTokenCookieName=function(){return this.settings.accessTokenCookie+"_"+this.settings.instanceId},e.prototype.readAccessToken=function(){if("undefined"!=typeof window){var a=(new Date).getTime(),b=this,c=this.readCookie(this.getAccessTokenCookieName());if(c){var d=c.split("|",3);if(3===d.length){var e=a-parseInt(d[0],10),f=a-parseInt(d[1],10);e<this.settings.maxAccessTokenInactivityTime&&f<this.settings.maxAccessTokenCreationTime&&(this.settings.accessToken=d[2],this.settings.autoExpire&&(b.setAccessTokenInactiveTimer(this.settings.maxAccessTokenInactivityTime-e),b.setAccessTokenCreationTimer(this.settings.maxAccessTokenCreationTime-f)))}}}},e.prototype.setAccessToken=function(a){if(this.settings.accessToken=a,"undefined"!=typeof window&&(this.settings.autoExpire&&(this.setAccessTokenInactiveTimer(this.settings.maxAccessTokenInactivityTime),this.setAccessTokenCreationTimer(this.settings.maxAccessTokenCreationTime)),this.settings.saveAccessToken)){var b=(new Date).getTime(),c=b+"|"+b+"|"+a;this.createCookie(this.getAccessTokenCookieName(),c,0)}},e.prototype.refreshAccessToken=function(){var a=(new Date).getTime();if(this.settings.autoExpire&&this.setAccessTokenInactiveTimer(this.settings.maxAccessTokenInactivityTime),this.settings.saveAccessToken){var b=this.readCookie(this.getAccessTokenCookieName());if(b){var c=b.split("|",3);3===c.length&&(b=a+"|"+c[1]+"|"+c[2],this.createCookie(this.getAccessTokenCookieName(),b,0))}}},e.prototype.eraseAccessToken=function(a){this.settings.accessToken=null,"undefined"!=typeof window&&(this.settings.autoExpire&&this.clearAccessTokenTimers(),this.settings.saveAccessToken&&this.eraseCookie(this.getAccessTokenCookieName()),this.settings.expireCallback&&!a&&this.settings.expireCallback())},e.prototype.extendHttpPromise=function(a,b){return c.wrapFunctions(a,b,["getResponseHeader","getAllResponseHeaders","getStatusCode","getRequest"])},e.prototype.chainHttpPromises=function(){var a=arguments[0],b={},c=this;return d(Array.prototype.slice.call(arguments,1),function(d){a=a.then(function(){var a=d.apply(null,arguments);return a&&a.then&&c.extendHttpPromise(b,a),a})}),c.extendHttpPromise(a,b),a},e.prototype.getLastUrlSegment=function(a){return a&&(a=a.replace(/^.*\//,"").replace(/\?.*$/,"")),a},e.prototype.getResponseEntityId=function(a,b){return b.getResponseHeader("X-ENTITY-ID")},e.prototype.getResponseLocation=function(a,b){return this.removeAccessToken(b.getResponseHeader("Location"))},e.prototype.isAbsoluteUrl=function(a){return/^https?:\/\//.test(a)},e.prototype.isAuthoritiesServerUrl=function(a){return-1!==a.indexOf("/authorities/v1/")},e.prototype.encodeQueryString=function(a){var b=[];return d(a,function(a,d){d=encodeURIComponent(d);var e;e=c.isArray(a)?c.map(a,function(a){return d+"="+encodeURIComponent(a)}).join("&"):null!=a?d+"="+encodeURIComponent(a):d,b.push(e)}),b.join("&")},e.prototype.appendQueryParameters=function(a,b){var c=this.encodeQueryString(b);return 0===c.length?a:a+(a.indexOf("?")>=0?"&":"?")+c},e.prototype.decodeQueryString=function(a){var b={};if(a){var e=a.indexOf("?");if(-1!==e){var f=a.substring(e+1).split("&");d(f,function(a){var d=a.split("=",2);if(d&&d[0]){var e=decodeURIComponent(d[0]),f=null!=d[1]?decodeURIComponent(d[1]):d[1];null==b[e]||c.isArray(b[e])||(b[e]=[b[e]]),null!=b[e]?b[e].push(f):b[e]=f}})}}return b},e.prototype.removeQueryString=function(a){if(a){var b=a.indexOf("?");-1!==b&&(a=a.substring(0,b))}return a},e.prototype.removeAccessToken=function(a){if(a){var b=this.decodeQueryString(a);a=this.removeQueryString(a),delete b.access_token,a=this.appendQueryParameters(a,b)}return a},e.prototype.populateUriTemplate=function(a,b){for(var c=a.split(/[{}]/),d=!1,e=0,f=c.length;f>e;e++)if(e%2===1){var g=b[c[e]];c[e]=d?encodeURIComponent(g):encodeURI(g)}else-1!==c[e].indexOf("?")&&(d=!0);return c.join("")},e.prototype.getUrlFromDiscoveryResource=function(a,b,c){var d="",e=a.links[b];if(e.href)d=this.removeAccessToken(e.href);else if(e.template){var f=e.template.replace(/{\?[^}]*}/,"");d=this.populateUriTemplate(f,c||{})}return d},e.prototype.attributionNeeded=function(a){return!(a.attribution&&a.attribution.changeMessage&&!a.attribution.contributor)},e.prototype.createCookie=function(a,b,c){var d="",e="https"===document.location.protocol&&"localhost"!==document.location.hostname;if(c){var f=new Date;f.setTime(f.getTime()+86400*c),d="; expires="+f.toUTCString()}document.cookie=a+"="+b+d+"; path=/"+(e?"; secure":"")},e.prototype.readCookie=function(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "===e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(b))return e.substring(b.length,e.length)}return null},e.prototype.eraseCookie=function(a){this.createCookie(a,"",-1)},b.exports=e},{"./utils":47}],28:[function(a,b,c){var d=a("./utils"),c={};c.httpWrapper=function(a,b){return function(c,e,f,g,h){h=d.extend({url:e,type:c,dataType:"json",data:g,processData:!1},h),h.headers=d.extend({},f,h.headers),"multipart/form-data"===h.headers["Content-Type"]&&(h.contentType=!1,delete h.headers["Content-Type"]);var i=a(h),j=b.settings.deferredWrapper(),k=j.promise,l=null;return i.then(function(a,b,c){l=c.status,j.resolve(a)},function(a,b,c){l=a.status,l>=200&&299>=l&&!a.responseText?j.resolve(null):j.reject(a,b,c)}),d.wrapFunctions(k,i,["getResponseHeader","getAllResponseHeaders"]),k.getStatusCode=function(){return l},k.getRequest=function(){return h},k}},c.deferredWrapper=function(a){return function(){var b=a();return{promise:b.promise(),resolve:b.resolve,reject:b.reject}}},b.exports=c},{"./utils":47}],29:[function(a){var b=a("./../FamilySearch"),c=a("./../utils");b.prototype.getAuthCode=function(){var a=this,b=a.settings;if("undefined"==typeof window){var c=b.deferredWrapper();return c.reject(),c.promise}return a.plumbing.getUrl("http://oauth.net/core/2.0/endpoint/authorize").then(function(c){var d=a.openPopup(c,{response_type:"code",client_id:b.clientId,redirect_uri:b.redirectUri});return a._pollForAuthCode(d)})},b.prototype.handleAccessTokenResponse=function(a,b){var c=this;a.then(function(a){var d=a.access_token;d?(c.helpers.setAccessToken(d),b.resolve(d)):b.reject(a.error)},function(){b.reject.apply(b,arguments)})},b.prototype.getAccessToken=function(a){var b=this,c=b.settings,d=c.deferredWrapper(),e=b.plumbing,f=b.helpers;if(c.accessToken)f.nextTick(function(){d.resolve(c.accessToken)});else{var g;g=a?f.refPromise(a):b.getAuthCode(),g.then(function(a){e.getUrl("http://oauth.net/core/2.0/endpoint/token").then(function(f){var g=e.post(f,{grant_type:"authorization_code",code:a,client_id:c.clientId},{"Content-Type":"application/x-www-form-urlencoded"});b.handleAccessTokenResponse(g,d)})},function(){d.reject.apply(d,arguments)})}return d.promise},b.prototype.getAccessTokenForMobile=function(a,b){var c=this,d=c.settings.deferredWrapper(),e=c.plumbing,f=c.helpers;return c.settings.accessToken?f.nextTick(function(){d.resolve(c.settings.accessToken)}):e.getUrl("http://oauth.net/core/2.0/endpoint/token").then(function(f){var g=e.post(f,{grant_type:"password",client_id:c.settings.clientId,username:a,password:b},{"Content-Type":"application/x-www-form-urlencoded"});c.handleAccessTokenResponse(g,d)}),d.promise},b.prototype.hasAccessToken=function(){return!!this.settings.accessToken},b.prototype.invalidateAccessToken=function(){var a=this;return a.helpers.eraseAccessToken(!0),a.helpers.chainHttpPromises(a.plumbing.getUrl("http://oauth.net/core/2.0/endpoint/token"),function(b){return a.plumbing.del(b)})},b.prototype.openPopup=function(a,b){var d=c.isUndefined(window.screenX)?window.screenLeft:window.screenX,e=c.isUndefined(window.screenY)?window.screenTop:window.screenY,f=c.isUndefined(window.outerWidth)?document.documentElement.clientWidth:window.outerWidth,g=c.isUndefined(window.outerHeight)?document.documentElement.clientHeight-22:window.outerHeight,h=b.width||780,i=b.height||500,j=parseInt(d+(f-h)/2,10),k=parseInt(e+(g-i)/2.5,10),l="width="+h+",height="+i+",left="+j+",top="+k;return window.open(this.helpers.appendQueryParameters(a,b),"",l)},b.prototype.getCode=function(a,b){var c=this.helpers.decodeQueryString(a);c.code?b.resolve(c.code):b.reject(c.error)},b.prototype._pollForAuthCode=function(a){var b=this,c=b.settings.deferredWrapper();if(a){var d=setInterval(function(){try{a.location.hostname===window.location.hostname&&(b.getCode(a.location.href,c),clearInterval(d),a.close())}catch(e){}},b.settings.authCodePollDelay);window.FamilySearchOauthReceiver=function(a){b.getCode(a,c),clearInterval(d)}}else c.reject("Popup blocked");return c.promise}},{"./../FamilySearch":1,"./../utils":47}],30:[function(a){var b=a("./../FamilySearch"),c=a("./../utils");b.prototype.getDate=function(a,b){var d=this,e={date:a,dataFormat:"application/json"};return d.plumbing.get(d.helpers.getAuthoritiesServerUrl("/authorities/v1/date"),e,{Accept:"application/json"},b,c.compose(c.objectExtender({getDate:function(){return c.maybe(c.maybe(this.dates).date)[0]}}),function(a){return c.forEach(a.dates.date,function(a,b,c){c[b]=d.createDate(a)}),a}))},b.prototype.getPlaceSearch=function(a,b){var d=this,e={place:a,view:"simple",dataFormat:"application/json"};return d.plumbing.get(d.helpers.getAuthoritiesServerUrl("/authorities/v1/place"),e,{Accept:"application/json"},b,c.compose(c.objectExtender({getPlaces:function(){return c.maybe(this.places).place}}),function(a){return c.forEach(a.places.place,function(a,b,c){c[b]=d.createPlace(a)}),a}))}},{"./../FamilySearch":1,"./../utils":47}],31:[function(a){var b=a("./../FamilySearch"),c=a("./../utils");b.prototype._changeHistoryResponseMapper=function(){var a=this;return c.compose(c.objectExtender({getChanges:function(){return this.entries||[]}}),function(b){
for(var c=0;c<b.entries.length;c++)b.entries[c]=a.createChange(b.entries[c]);return b})},b.prototype.getPersonChanges=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("person-changes-template",a,{pid:a}),function(a){return d.plumbing.get(a,b,{Accept:"application/x-gedcomx-atom+json"},c,d._changeHistoryResponseMapper())})},b.prototype.getChildAndParentsChanges=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("child-and-parents-relationship-changes-template",a,{caprid:a}),function(a){return d.plumbing.get(a,b,{Accept:"application/x-gedcomx-atom+json"},c,d._changeHistoryResponseMapper())})},b.prototype.getCoupleChanges=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("couple-relationship-changes-template",a,{crid:a}),function(a){return d.plumbing.get(a,b,{Accept:"application/x-gedcomx-atom+json"},c,d._changeHistoryResponseMapper())})},b.prototype.restoreChange=function(a,b){var c=this;return c.helpers.chainHttpPromises(c.plumbing.getUrl("change-restore-template",a,{chid:a}),function(d){return c.plumbing.post(d,null,{"Content-Type":void 0},b,function(){return a})})}},{"./../FamilySearch":1,"./../utils":47}],32:[function(a){var b=a("./../FamilySearch"),c=a("./../utils"),d=c.maybe;b.prototype.getDiscussion=function(a,b,e){var f=this;return f.helpers.chainHttpPromises(f.plumbing.getUrl("discussion-template",a,{did:a}),function(a){return f.plumbing.get(a,b,{Accept:"application/x-fs-v1+json"},e,c.compose(c.objectExtender({getDiscussion:function(){return d(d(this).discussions)[0]}}),function(a){for(var b=0;b<a.discussions.length;b++)a.discussions[b]=f.createDiscussion(a.discussions[b]);return a}))})},b.prototype.getMultiDiscussion=function(a,d,e){var f=this,g={};return c.forEach(a,function(a){var c,h;a instanceof b.DiscussionRef?(h=a.$getDiscussionUrl(),c=a.resourceId):(h=a,c=a),g[c]=f.getDiscussion(h,d,e)}),f.helpers.promiseAll(g)},b.prototype.getPersonDiscussionRefs=function(a,b,e){var f=this;return f.helpers.chainHttpPromises(f.plumbing.getUrl("person-discussion-references-template",a,{pid:a}),function(a){return f.plumbing.get(a,b,{Accept:"application/x-fs-v1+json"},e,c.compose(c.objectExtender({getDiscussionRefs:function(){return d(d(d(this).persons)[0])["discussion-references"]||[]}}),function(a){if(a&&a.persons&&a.persons[0]&&c.isArray(a.persons[0]["discussion-references"]))for(var b=a.persons[0]["discussion-references"],d=0;d<b.length;d++)b[d]=f.createDiscussionRef(b[d]);return a},c.objectExtender(function(a){return{$personId:d(d(d(a).persons)[0]).id}},function(a){return d(d(d(a).persons)[0])["discussion-references"]})))})},b.prototype._commentsResponseMapper=function(){var a=this;return c.compose(c.objectExtender({getComments:function(){return d(d(d(this).discussions)[0]).comments||[]}}),function(b){if(b&&b.discussions&&b.discussions[0]&&c.isArray(b.discussions[0].comments))for(var d=b.discussions[0].comments,e=0;e<d.length;e++)d[e]=a.createComment(d[e]);return b})},b.prototype.getDiscussionComments=function(a,b,e){var f=this;return f.helpers.chainHttpPromises(f.plumbing.getUrl("discussion-comments-template",a,{did:a}),function(a){return f.plumbing.get(a,b,{Accept:"application/x-fs-v1+json"},e,c.compose(f._commentsResponseMapper(),c.objectExtender(function(a){return{$discussionId:d(d(d(a).discussions)[0]).id}},function(a){return d(d(d(a).discussions)[0]).comments})))})},b.prototype.deleteDiscussion=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("discussion-template",a,{did:a}),function(b){return d.plumbing.del(b,{"Content-Type":"application/x-fs-v1+json"},c,function(){return a})})},b.prototype.deleteDiscussionRef=function(a,b,c,d){var e=this;return e.helpers.chainHttpPromises(e.plumbing.getUrl("person-discussion-reference-template",a,{pid:a,drid:b}),function(b){var f={"Content-Type":"application/x-fs-v1+json"};return c&&(f["X-Reason"]=c),e.plumbing.del(b,f,d,function(){return a})})},b.prototype.deleteDiscussionComment=function(a,b,c,d){var e=this;return e.helpers.chainHttpPromises(e.plumbing.getUrl("discussion-comment-template",a,{did:a,cmid:b}),function(b){return e.plumbing.del(b,{"Content-Type":"application/x-fs-v1+json"},d,function(){return a})})},b.prototype.deleteMemoryComment=function(a,b,c,d){var e=this;return e.helpers.chainHttpPromises(e.plumbing.getUrl("memory-comment-template",a,{mid:a,cmid:b}),function(b){return e.plumbing.del(b,{},d,function(){return a})})}},{"./../FamilySearch":1,"./../utils":47}],33:[function(a){var b=a("./../FamilySearch"),c=a("./../utils"),d=c.maybe;b.prototype._memoriesResponseMapper=function(){var a=this;return function(b){if(b&&c.isArray(b.sourceDescriptions))for(var d=0;d<b.sourceDescriptions.length;d++)b.sourceDescriptions[d].attribution&&(b.sourceDescriptions[d].attribution=a.createAttribution(b.sourceDescriptions[d].attribution)),b.sourceDescriptions[d]=a.createMemory(b.sourceDescriptions[d]);return b}},b.prototype.getPersonMemoriesQuery=function(a,b,d){var e=this;return e.helpers.chainHttpPromises(e.plumbing.getUrl("person-memories-query",a,{pid:a}),function(a){return e.plumbing.get(a,b,{},d,c.compose(c.objectExtender({getMemories:function(){return this.sourceDescriptions||[]}}),e._memoriesResponseMapper()))})},b.prototype.getUserMemoriesQuery=function(a,b,d){var e=this;return e.helpers.chainHttpPromises(e.plumbing.getUrl("user-memories-query",a,{cisUserId:a}),function(a){return e.plumbing.get(a,b,{},d,c.compose(c.objectExtender({getMemories:function(){return this.sourceDescriptions||[]}}),e._memoriesResponseMapper()))})},b.prototype.getMemory=function(a,b,e){var f=this;return f.helpers.chainHttpPromises(f.plumbing.getUrl("memory-template",a,{mid:a}),function(a){return f.plumbing.get(a,b,{},e,c.compose(c.objectExtender({getMemory:function(){return d(this.sourceDescriptions)[0]}}),f._memoriesResponseMapper()))})},b.prototype.getMemoryComments=function(a,b,e){var f=this;return f.helpers.chainHttpPromises(f.plumbing.getUrl("memory-comments-template",a,{mid:a}),function(a){return f.plumbing.get(a,b,{Accept:"application/x-fs-v1+json"},e,c.compose(f._commentsResponseMapper(),c.objectExtender(function(a){return{$memoryId:d(d(d(a).sourceDescriptions)[0]).id}},function(a){return d(d(d(a).discussions)[0]).comments})))})},b.prototype._memoryPersonasMapper=function(){var a=this;return c.compose(function(b){if(b&&c.isArray(b.persons))for(var d=0;d<b.persons.length;d++)b.persons[d]=a.createMemoryPersona(b.persons[d]);return b},function(b){if(b&&c.isArray(b.persons))for(var d=0;d<b.persons.length;d++)if(c.isArray(b.persons[d].names))for(var e=0;e<b.persons[d].names.length;e++)b.persons[d].names[e]=a.createName(b.persons[d].names[e]);return b},function(b){if(b&&c.isArray(b.persons))for(var d=0;d<b.persons.length;d++)b.persons[d].media&&(b.persons[d].media=a.createMemoryArtifactRef(b.persons[d].media));return b},c.objectExtender(function(a){return{$memoryId:d(d(a.sourceDescriptions)[0]).id}},function(a){return d(a).persons}))},b.prototype.getMemoryPersonas=function(a,b,d){var e=this;return e.helpers.chainHttpPromises(e.plumbing.getUrl("memory-personas-template",a,{mid:a}),function(a){return e.plumbing.get(a,b,{},d,c.compose(c.objectExtender({getMemoryPersonas:function(){return this&&this.persons?this.persons:[]}}),e._memoryPersonasMapper()))})},b.prototype.getMemoryPersona=function(a,b,e,f){var g=this;return g.helpers.chainHttpPromises(g.plumbing.getUrl("memory-persona-template",a,{mid:a,pid:b}),function(a){return g.plumbing.get(a,e,{},f,c.compose(c.objectExtender({getMemoryPersona:function(){return d(this.persons)[0]}}),g._memoryPersonasMapper()))})},b.prototype.getMemoryPersonaRefs=function(a,b,e){var f=this;return f.helpers.chainHttpPromises(f.plumbing.getUrl("person-memory-persona-references-template",a,{pid:a}),function(a){return f.plumbing.get(a,b,{},e,c.compose(c.objectExtender({getMemoryPersonaRefs:function(){return d(d(this.persons)[0]).evidence||[]}}),function(a){try{if(a&&c.isArray(a.persons)&&a.persons[0]){var b=a.persons[0];if(b.evidence&&c.isArray(b.evidence))for(var d=0;d<b.evidence.length;d++)b.evidence[d]=f.createMemoryPersonaRef(b.evidence[d])}}catch(e){console.error(e.stack)}return a},c.objectExtender(function(a){return{$personId:d(d(d(a).persons)[0]).id}},function(a){return d(d(d(a).persons)[0]).evidence})))})},b.prototype.getPersonPortraitUrl=function(a,b,d){var e=this;return e.plumbing.getUrl("person-portrait-template",a,{pid:a}).then(function(a){if(b&&b.followRedirect){b=c.extend({},b),delete b.followRedirect;var f=e.plumbing.get(a,b,{"X-Expect-Override":"200-ok"},d);return f.then(function(){return 204===f.getStatusCode()?"":e.helpers.appendAccessToken(f.getResponseHeader("Location"))})}return e.helpers.appendAccessToken(a)})},b.prototype.deleteMemory=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("memory-template",a,{mid:a}),function(b){return d.plumbing.del(b,{},c,function(){return a})})},b.prototype.deleteMemoryPersona=function(a,b,c,d){var e=this;return e.helpers.chainHttpPromises(e.plumbing.getUrl("memory-persona-template",a,{mid:a,pid:b}),function(b){return e.plumbing.del(b,{},d,function(){return a})})},b.prototype.deleteMemoryPersonaRef=function(a,b,c,d){var e=this;return e.helpers.chainHttpPromises(e.plumbing.getUrl("person-memory-persona-reference-template",a,{pid:a,erid:b}),function(b){return e.plumbing.del(b,{},d,function(){return a})})}},{"./../FamilySearch":1,"./../utils":47}],34:[function(a){function b(a){if(a){if(a.persons)return a.persons;if(a.childAndParentsRelationships)return a.childAndParentsRelationships;if(a.relationships)return a.relationships}return{}}var c=a("./../FamilySearch"),d=a("./../utils"),e=d.maybe;c.prototype._getNote=function(a,c,f){var g=this;return g.plumbing.get(a,c,{Accept:"application/x-fs-v1+json"},f,d.compose(d.objectExtender({getNote:function(){return e(e(b(this)[0]).notes)[0]}}),function(a){var c=e(b(a)[0]).notes;return d.forEach(c,function(a,b){c[b]=g.createNote(a)}),a},d.objectExtender(function(a){var c=a.persons?"$personId":a.childAndParentsRelationships?"$childAndParentsId":"$coupleId",d={};return d[c]=e(b(a)[0]).id,d},function(a){return e(b(a)[0]).notes})))},c.prototype._getMultiNote=function(a,b,c,e,f){var g=this,h={};return d.isArray(a)?d.forEach(a,function(a){h[a]=f.call(g,a,null,c,e)}):d.forEach(b,function(b){h[b]=f.call(g,a,b,c,e)}),h},c.prototype.getPersonNote=function(a,b,c,d){var e=this;return e.helpers.chainHttpPromises(e.plumbing.getUrl("person-note-template",a,{pid:a,nid:b}),function(a){return e._getNote(a,c,d)})},c.prototype.getMultiPersonNote=function(a,b,c,d){var e=this._getMultiNote(a,b,c,d,this.getPersonNote);return this.helpers.promiseAll(e)},c.prototype.getCoupleNote=function(a,b,c,d){var e=this;return e.helpers.chainHttpPromises(e.plumbing.getUrl("couple-relationship-note-template",a,{crid:a,nid:b}),function(a){return e._getNote(a,c,d)})},c.prototype.getMultiCoupleNote=function(a,b,c,d){var e=this._getMultiNote(a,b,c,d,this.getCoupleNote);return this.helpers.promiseAll(e)},c.prototype.getChildAndParentsNote=function(a,b,c,d){var e=this;return e.helpers.chainHttpPromises(e.plumbing.getUrl("child-and-parents-relationship-note-template",a,{caprid:a,nid:b}),function(a){return e._getNote(a,c,d)})},c.prototype.getMultiChildAndParentsNote=function(a,b,c,d){var e=this._getMultiNote(a,b,c,d,this.getChildAndParentsNote);return this.helpers.promiseAll(e)},c.prototype.getPersonNotes=function(a,b,c){var f=this;return f.helpers.chainHttpPromises(f.plumbing.getUrl("person-notes-template",a,{pid:a}),function(a){return f.plumbing.get(a,b,{},c,d.compose(d.objectExtender({getNotes:function(){return e(e(e(this).persons)[0]).notes||[]}}),function(a){var b=e(e(e(a).persons)[0]).notes;return d.forEach(b,function(a,c){b[c]=f.createNote(a)}),a},d.objectExtender(function(a){return{$personId:e(e(e(a).persons)[0]).id}},function(a){return e(e(e(a).persons)[0]).notes})))})},c.prototype.getCoupleNotes=function(a,b,c){var f=this;return f.helpers.chainHttpPromises(f.plumbing.getUrl("couple-relationship-notes-template",a,{crid:a}),function(a){return f.plumbing.get(a,b,{},c,d.compose(d.objectExtender({getNotes:function(){return e(e(this.relationships)[0]).notes||[]}}),function(a){var b=e(e(e(a).relationships)[0]).notes;return d.forEach(b,function(a,c){b[c]=f.createNote(a)}),a},d.objectExtender(function(a){return{$coupleId:e(e(e(a).relationships)[0]).id}},function(a){return e(e(e(a).relationships)[0]).notes})))})},c.prototype.getChildAndParentsNotes=function(a,b,c){var f=this;return f.helpers.chainHttpPromises(f.plumbing.getUrl("child-and-parents-relationship-notes-template",a,{caprid:a}),function(a){return f.plumbing.get(a,b,{Accept:"application/x-fs-v1+json"},c,d.compose(d.objectExtender({getNotes:function(){return e(e(this.childAndParentsRelationships)[0]).notes||[]}}),function(a){var b=e(e(e(a).childAndParentsRelationships)[0]).notes;return d.forEach(b,function(a,c){b[c]=f.createNote(a)}),a},d.objectExtender(function(a){return{$childAndParentsId:e(e(e(a).childAndParentsRelationships)[0]).id}},function(a){return e(e(e(a).childAndParentsRelationships)[0]).notes})))})},c.prototype.deletePersonNote=function(a,b,c,d){var e=this;return e.helpers.chainHttpPromises(e.plumbing.getUrl("person-note-template",a,{pid:a,nid:b}),function(b){var f={"Content-Type":"application/x-fs-v1+json"};return c&&(f["X-Reason"]=c),e.plumbing.del(b,f,d,function(){return a})})},c.prototype.deleteCoupleNote=function(a,b,c,d){var e=this;return e.helpers.chainHttpPromises(e.plumbing.getUrl("couple-relationship-note-template",a,{crid:a,nid:b}),function(b){var f={};return c&&(f["X-Reason"]=c),e.plumbing.del(b,f,d,function(){return a})})},c.prototype.deleteChildAndParentsNote=function(a,b,c,d){var e=this;return e.helpers.chainHttpPromises(e.plumbing.getUrl("child-and-parents-relationship-note-template",a,{caprid:a,nid:b}),function(b){var f={"Content-Type":"application/x-fs-v1+json"};return c&&(f["X-Reason"]=c),e.plumbing.del(b,f,d,function(){return a})})}},{"./../FamilySearch":1,"./../utils":47}],35:[function(a){var b=a("../FamilySearch"),c=a("../utils"),d=c.maybe,e={getRelationship:function(){return d(this.childAndParentsRelationships)[0]},getPerson:function(a){return c.find(this.persons,{id:a})}};b.prototype.getChildAndParents=function(a,b,d){var f=this;return f.helpers.chainHttpPromises(f.plumbing.getUrl("child-and-parents-relationship-template",a,{caprid:a}),function(a){return f.plumbing.get(a,b,{Accept:"application/x-fs-v1+json"},d,c.compose(c.objectExtender(e),function(a){return c.forEach(a.persons,function(a,b,c){c[b]=f.createPerson(a)}),c.forEach(a.childAndParentsRelationships,function(a,b,c){c[b]=f.createChildAndParents(a)}),a}))})},b.prototype.deleteChildAndParents=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("child-and-parents-relationship-template",a,{caprid:a}),function(e){var f={"Content-Type":"application/x-fs-v1+json"};return b&&(f["X-Reason"]=b),d.plumbing.del(e,f,c,function(){return a})})}},{"../FamilySearch":1,"../utils":47}],36:[function(a){function b(a){return{getPersons:function(){return this.persons},exists:function(b){return!!f(e.find(this.persons,c(a,b))).id},getPerson:function(b){return e.find(this.persons,c(a,b))}}}function c(a,b){return function(c){return c.display[a]==b}}var d=a("./../FamilySearch"),e=a("./../utils"),f=e.maybe;d.prototype.getAncestry=function(a,d,g){var h=this;return h.helpers.chainHttpPromises(h.plumbing.getUrl("ancestry-query"),function(i){return h.plumbing.get(i,e.extend({person:a},d),{},g,e.compose(e.objectExtender(b("ascendancyNumber")),d&&d.descendants?e.objectExtender({getDescendant:function(a){return e.find(this.persons,c("descendancyNumber",a))},existsDescendant:function(a){return!!f(e.find(this.persons,c("descendancyNumber",a))).id}}):null,function(a){return e.forEach(a.persons,function(a,b,c){c[b]=h.createPerson(a)}),a},e.objectExtender({$getAscendancyNumber:function(){return this.display.ascendancyNumber}},function(a){return f(a).persons}),d&&d.descendants?e.objectExtender({$getDescendancyNumber:function(){return this.display.descendancyNumber}},function(a){return f(a).persons}):null))})},d.prototype.getDescendancy=function(a,c,d){var g=this;return g.helpers.chainHttpPromises(g.plumbing.getUrl("descendancy-query"),function(h){return g.plumbing.get(h,e.extend({person:a},c),{},d,e.compose(e.objectExtender(b("descendancyNumber")),function(a){return e.forEach(a.persons,function(a,b,c){c[b]=g.createPerson(a)}),a},e.objectExtender({$getDescendancyNumber:function(){return this.display.descendancyNumber}},function(a){return f(a).persons})))})}},{"./../FamilySearch":1,"./../utils":47}],37:[function(a){var b=a("../FamilySearch"),c=a("../utils"),d=c.maybe,e={getPerson:function(a){return c.find(this.persons,{id:a})},getPrimaryPerson:function(){return this.getPerson(this.getPrimaryId())},getParentRelationships:function(){var a=this.getPrimaryId();return c.filter(this.childAndParentsRelationships,function(b){return d(b.child).resourceId===a})},getSpouseRelationships:function(){return c.filter(this.relationships,function(a){return"http://gedcomx.org/Couple"===a.type})},getSpouseRelationship:function(a){var b=this.getPrimaryId();return c.find(this.relationships,function(c){return"http://gedcomx.org/Couple"===c.type&&(b===c.$getHusbandId()?c.$getWifeId():c.$getHusbandId())===a})},getChildRelationships:function(){var a=this.getPrimaryId();return c.filter(this.childAndParentsRelationships,function(b){return d(b.father).resourceId===a||d(b.mother).resourceId===a})},getChildRelationshipsOf:function(a){var b=this.getPrimaryId();return c.filter(this.childAndParentsRelationships,function(c){return!(d(c.father).resourceId!==b&&d(c.mother).resourceId!==b||d(c.father).resourceId!=a&&d(c.mother).resourceId!=a)})},getFatherIds:function(){return c.uniq(c.map(c.filter(this.getParentRelationships(),function(a){return!!a.$getFatherId()}),function(a){return a.$getFatherId()},this))},getFathers:function(){return c.map(this.getFatherIds(),this.getPerson,this)},getMotherIds:function(){return c.uniq(c.map(c.filter(this.getParentRelationships(),function(a){return!!a.$getMotherId()}),function(a){return a.$getMotherId()},this))},getMothers:function(){return c.map(this.getMotherIds(),this.getPerson,this)},getSpouseIds:function(){return c.uniq(c.map(c.filter(this.getSpouseRelationships(),function(a){return a.$getHusbandId()&&a.$getWifeId()}),function(a){return this.getPrimaryId()===a.$getHusbandId()?a.$getWifeId():a.$getHusbandId()},this))},getSpouses:function(){return c.map(this.getSpouseIds(),this.getPerson,this)},getChildIds:function(){return c.uniq(c.map(this.getChildRelationships(),function(a){return a.$getChildId()},this))},getChildren:function(){return c.map(this.getChildIds(),this.getPerson,this)},getChildIdsOf:function(a){return c.uniq(c.map(this.getChildRelationshipsOf(a),function(a){return a.$getChildId()},this))},getChildrenOf:function(a){return c.map(this.getChildIdsOf(a),this.getPerson,this)}};b.prototype.getPerson=function(a,b,d){var e=this;return e.helpers.chainHttpPromises(e.plumbing.getUrl("person-template",a,{pid:a}),function(a){return e.plumbing.get(a,b,{},d,c.compose(c.objectExtender({getPerson:function(){return this.persons[0]}}),function(a){return c.forEach(a.persons,function(a,b,c){c[b]=e.createPerson(a)}),a},function(a,b){return a.persons[0].$isReadOnly=function(){var a=b.getResponseHeader("Allow");return!!a&&a.indexOf("POST")<0},a}))})},b.prototype.getMultiPerson=function(a,b,d){var e={},f=this;return c.forEach(a,function(a){e[a]=f.getPerson(a,b,d)}),f.helpers.promiseAll(e)},b.prototype._personsAndRelationshipsMapper=function(){var a=this;return c.compose(c.objectExtender({getCoupleRelationships:function(){return c.filter(d(this).relationships,{type:"http://gedcomx.org/Couple"})||[]},getChildAndParentsRelationships:function(){return d(this).childAndParentsRelationships||[]},getPerson:function(a){return c.find(this.persons,{id:a})}}),function(b){return c.forEach(b.persons,function(b,c,d){d[c]=a.createPerson(b)}),c.forEach(b.relationships,function(b,c,d){d[c]=a.createCouple(b)}),c.forEach(b.childAndParentsRelationships,function(b,c,d){d[c]=a.createChildAndParents(b)}),b})},b.prototype.getPersonWithRelationships=function(a,b,d){var f=this;return f.helpers.chainHttpPromises(f.plumbing.getUrl("person-with-relationships-query"),function(g){return f.plumbing.get(g,c.extend({person:a},b),{},d,c.compose(c.objectExtender({getPrimaryId:function(){return a}}),f._personsAndRelationshipsMapper(),c.objectExtender(e),function(a,b){return a.persons[0].$isReadOnly=function(){var a=b.getResponseHeader("Allow");return!!a&&a.indexOf("POST")<0},a}))})},b.prototype.getSpouses=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("spouses-template",a,{pid:a}),function(a){return d.plumbing.get(a,b,{},c,d._personsAndRelationshipsMapper())})},b.prototype.getParents=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("parents-template",a,{pid:a}),function(a){return d.plumbing.get(a,b,{},c,d._personsAndRelationshipsMapper())})},b.prototype.getChildren=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("children-template",a,{pid:a}),function(a){return d.plumbing.get(a,b,{},c,d._personsAndRelationshipsMapper())})},b.prototype.deletePerson=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("person-template",a,{pid:a}),function(e){return d.plumbing.del(e,b?{"X-Reason":b}:{},c,function(){return a})})},b.prototype.getPreferredSpouse=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.getCurrentUser(),function(b){var c=b.getUser().treeUserId;return d.plumbing.getUrl("preferred-spouse-relationship-template",null,{uid:c,pid:a})},function(a){var e=d.plumbing.get(a+".json",b,{"X-Expect-Override":"200-ok"},c);return e.then(function(){if(200===e.getStatusCode()){var a=e.getResponseHeader("Location");return a.indexOf("child-and-parents-relationships")>=0?null:d.helpers.getLastUrlSegment(a)}return void 0})})},b.prototype.setPreferredSpouse=function(a,b,d){var e,f=[],g=this;return null===b?f.push(g.getChildren(a),function(a){var b=c.find(a.getChildAndParentsRelationships(),function(a){return!a.$getFatherId()||!a.$getMotherId()});return g.plumbing.getUrl("child-and-parents-relationship-template",null,{caprid:b.id})}):f.push(g.plumbing.getUrl("couple-relationship-template",b,{crid:b})),f.push(function(a){return e=a,g.getCurrentUser()},function(b){var c=b.getUser().treeUserId;return g.plumbing.getUrl("preferred-spouse-relationship-template",null,{uid:c,pid:a})},function(b){return g.plumbing.put(b,null,{Location:e},d,function(){return a})}),g.helpers.chainHttpPromises.apply(g.helpers,f)},b.prototype.deletePreferredSpouse=function(a,b){var c=this;return c.helpers.chainHttpPromises(c.getCurrentUser(),function(b){var d=b.getUser().treeUserId;return c.plumbing.getUrl("preferred-spouse-relationship-template",null,{uid:d,pid:a})},function(d){return c.plumbing.del(d,{},b,function(){return a})})},b.prototype.getPreferredParents=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.getCurrentUser(),function(b){var c=b.getUser().treeUserId;return d.plumbing.getUrl("preferred-parent-relationship-template",null,{uid:c,pid:a})},function(a){var e=d.plumbing.get(a+".json",b,{Accept:"application/x-fs-v1+json","X-Expect-Override":"200-ok"},c);return e.then(function(){return 200===e.getStatusCode()?d.helpers.getLastUrlSegment(e.getResponseHeader("Location")):void 0})})},b.prototype.setPreferredParents=function(a,b,c){var d,e=this;return e.helpers.chainHttpPromises(e.plumbing.getUrl("child-and-parents-relationship-template",b,{caprid:b}),function(a){return d=a,e.getCurrentUser()},function(b){var c=b.getUser().treeUserId;return e.plumbing.getUrl("preferred-parent-relationship-template",null,{uid:c,pid:a})},function(b){return e.plumbing.put(b,null,{Location:d},c,function(){return a})})},b.prototype.deletePreferredParents=function(a,b){var c=this;return c.helpers.chainHttpPromises(c.getCurrentUser(),function(b){var d=b.getUser().treeUserId;return c.plumbing.getUrl("preferred-parent-relationship-template",null,{uid:d,pid:a})},function(d){return c.plumbing.del(d,{},b,function(){return a})})}},{"../FamilySearch":1,"../utils":47}],38:[function(a){var b=a("./../FamilySearch");b.prototype.getRedirectUrl=function(a){return this.helpers.appendAccessToken(this.helpers.appendQueryParameters(this.helpers.getAPIServerUrl("/platform/redirect"),a))}},{"./../FamilySearch":1}],39:[function(a){function b(a){return a=a.replace(/[:"]/g,"").trim(),a.indexOf(" ")>=0?'"'+a+'"':a}function c(a){return e.map(e.filter(e.keys(a),function(a){return!f[a]}),function(c){return c+":"+b(a[c])}).join(" ")}var d=a("./../FamilySearch"),e=a("./../utils"),f={start:!0,count:!0,context:!0},g={getSearchResults:function(){return this.entries||[]},getResultsCount:function(){return this.results||0},getIndex:function(){return this.index||0}};d.prototype._getSearchMatchResponseMapper=function(){var a=this;return e.compose(e.objectExtender(g),function(b){return e.forEach(b.entries,function(b,c,d){d[c]=a.createSearchResult(b)}),b})},d.prototype.getPersonSearch=function(a,b){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("person-search"),function(f){return d.plumbing.get(f,e.removeEmptyProperties({q:c(a),start:a.start,count:a.count,context:a.context}),{Accept:"application/x-gedcomx-atom+json"},b,e.compose(d._getSearchMatchResponseMapper(),function(a,b){return a.getContext=function(){return b.getResponseHeader("X-FS-Page-Context")},a}))})},d.prototype.getPersonMatches=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("person-matches-template",a,{pid:a}),function(a){return d.plumbing.get(a,b,{Accept:"application/x-gedcomx-atom+json"},c,d._getSearchMatchResponseMapper())})},d.prototype.getPersonMatchesQuery=function(a,b){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("person-matches-query"),function(f){return d.plumbing.get(f,e.removeEmptyProperties({q:c(a),start:a.start,count:a.count}),{Accept:"application/x-gedcomx-atom+json"},b,d._getSearchMatchResponseMapper())})}},{"./../FamilySearch":1,"./../utils":47}],40:[function(a){var b=a("./../FamilySearch"),c=a("./../utils"),d=c.maybe;b.prototype.getCollectionsForUser=function(a,b,d){var e=this;return e.helpers.chainHttpPromises(e.plumbing.getUrl("user-collections-for-user-template",a,{uid:a}),function(a){return e.plumbing.get(a,{},{Accept:"application/x-fs-v1+json"},d,c.compose(c.objectExtender({getCollections:function(){return this.collections||[]}}),function(a){return c.forEach(a.collections,function(a,b,c){c[b]=e.createCollection(a)}),a}))})},b.prototype.getCollection=function(a,b,e){var f=this;return f.helpers.chainHttpPromises(f.plumbing.getUrl("user-collection-template",a,{udcid:a}),function(a){return f.plumbing.get(a,b,{Accept:"application/x-fs-v1+json"},e,c.compose(c.objectExtender({getCollection:function(){return d(this.collections)[0]}}),function(a){return c.forEach(a.collections,function(a,b,c){c[b]=f.createCollection(a)}),a}))})},b.prototype.getCollectionSourceDescriptions=function(a,b,d){var e=this;return e.helpers.chainHttpPromises(e.plumbing.getUrl("user-collection-source-descriptions-template",a,{udcid:a}),function(a){return e.plumbing.get(a,b,{Accept:"application/x-fs-v1+json"},d,c.compose(c.objectExtender({getSourceDescriptions:function(){return this.sourceDescriptions||[]}}),function(a){return c.forEach(a.sourceDescriptions,function(a,b,c){c[b]=e.createSourceDescription(a)}),a}))})},b.prototype.getCollectionSourceDescriptionsForUser=function(a,b,d){var e=this;return e.helpers.chainHttpPromises(e.plumbing.getUrl("user-collections-source-descriptions-for-user-template",a,{uid:a}),function(a){return e.plumbing.get(a,b,{Accept:"application/x-fs-v1+json"},d,c.compose(c.objectExtender({getSourceDescriptions:function(){return this.sourceDescriptions||[]}}),function(a){return c.forEach(a.sourceDescriptions,function(a,b,c){c[b]=e.createSourceDescription(a)}),a}))})},b.prototype.moveSourceDescriptionsToCollection=function(a,d,e){var f=this;return f.helpers.chainHttpPromises(f.plumbing.getUrl("user-collection-source-descriptions-template",a,{udcid:a}),function(g){var h=c.map(d,function(a){return{id:a instanceof b.SourceDescription?a.id:a}});return f.plumbing.post(g,{sourceDescriptions:h},{},e,function(){return a})})},b.prototype.removeSourceDescriptionsFromCollections=function(a,d){var e=this;return e.helpers.chainHttpPromises(e.getCurrentUser(),function(a){var b=a.getUser().treeUserId;return e.plumbing.getUrl("user-collections-source-descriptions-for-user-template",null,{uid:b})},function(f){var g=c.map(a,function(a){return a instanceof b.SourceDescription?a.id:a});return e.plumbing.del(e.helpers.appendQueryParameters(f,{id:g}),{},d,function(){return a})})},b.prototype.deleteCollection=function(a,b){var c=this;return c.helpers.chainHttpPromises(c.plumbing.getUrl("user-collection-template",a,{udcid:a}),function(d){return c.plumbing.del(d,{},b,function(){return a})})}},{"./../FamilySearch":1,"./../utils":47}],41:[function(a){var b=a("./../FamilySearch"),c=a("./../utils"),d=c.maybe;b.prototype.getSourceDescription=function(a,e,f){a instanceof b.SourceRef&&(a=a.$getSourceDescriptionUrl()||a.$sourceDescriptionId);var g=this;return g.helpers.chainHttpPromises(g.plumbing.getUrl("source-description-template",a,{sdid:a}),function(a){return g.plumbing.get(a,e,{},f,c.compose(c.objectExtender({getSourceDescription:function(){return d(this.sourceDescriptions)[0]}}),function(a){for(var b=d(d(a).sourceDescriptions),c=0;c<b.length;c++)b[c]=g.createSourceDescription(b[c]);return a}))})},b.prototype.getMultiSourceDescription=function(a,d,e){var f={},g=this;return c.forEach(a,function(a){var c,h;a instanceof b.SourceRef?(c=a.$sourceDescriptionId||a.$getSourceDescriptionUrl(),h=a.$getSourceDescriptionUrl()||a.$sourceDescriptionId):(c=a,h=a),f[c]=g.getSourceDescription(h,d,e)}),g.helpers.promiseAll(f)},b.prototype.getSourceRefsQuery=function(a,b,e){var f=this;return f.helpers.chainHttpPromises(f.plumbing.getUrl("source-references-query"),function(g){return g=f.helpers.appendQueryParameters(g,{source:a}),f.plumbing.get(g,b,{Accept:"application/x-fs-v1+json"},e,c.compose(c.objectExtender({getPersonSourceRefs:function(){return c.flatMap(d(this.persons),function(a){return a.sources})}}),c.objectExtender({getCoupleSourceRefs:function(){return c.flatMap(d(this.relationships),function(a){return a.sources})}}),c.objectExtender({getChildAndParentsSourceRefs:function(){return c.flatMap(d(this.childAndParentsRelationships),function(a){return a.sources})}}),function(a){return c.forEach(["persons","relationships","childAndParentsRelationships"],function(b){d(a)[b]=c.map(d(a)[b],function(a){return a.sources=c.map(a.sources,function(a){return f.createSourceRef(a)}),a})}),a},c.objectExtender(function(b,e){var f=c.find(d(b).persons,function(a){return!!c.find(d(a).sources,{id:e.id})});return{$personId:f.id,$sourceDescriptionId:a}},function(a){return c.flatMap(d(a).persons,function(a){return a.sources})}),c.objectExtender(function(b,e){var f=c.find(d(b).relationships,function(a){return!!c.find(d(a).sources,{id:e.id})});return{$coupleId:f.id,$sourceDescriptionId:a}},function(a){return c.flatMap(d(a).relationships,function(a){return a.sources})}),c.objectExtender(function(b,e){var f=c.find(d(b).childAndParentsRelationships,function(a){return!!c.find(d(a).sources,{id:e.id})});return{$childAndParentsId:f.id,$sourceDescriptionId:a}},function(a){return c.flatMap(d(a).childAndParentsRelationships,function(a){return a.sources})})))})},b.prototype._getSourcesResponseMapper=function(a,b,e){var f=this;return c.compose(c.objectExtender(c.removeEmptyProperties({getSourceRefs:function(){return d(d(this[a])[0]).sources||[]},getSourceDescriptions:e?function(){return this.sourceDescriptions||[]}:null,getSourceDescription:e?function(a){
return c.find(this.sourceDescriptions,{id:a})}:null})),function(b){return c.forEach(d(d(d(b)[a])[0]).sources,function(a,b,c){c[b]=f.createSourceRef(a)}),b},c.objectExtender(function(c,e){var g;if(f.helpers.isAbsoluteUrl(e.description))g={$sourceDescriptionId:f.helpers.getLastUrlSegment(e.description)};else{var h="#"===e.description.charAt(0)?e.description.substr(1):e.description;g={$sourceDescriptionId:h,description:f.helpers.getUrlFromDiscoveryResource(f.settings.discoveryResource,"source-description-template",{sdid:h})}}return g[b]=d(d(d(c)[a])[0]).id,g},function(b){return d(d(d(b)[a])[0]).sources}),e?function(a){return c.forEach(a.sourceDescriptions,function(a,b,c){c[b]=f.createSourceDescription(a)}),a}:null)},b.prototype.getPersonSourceRefs=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("person-source-references-template",a,{pid:a}),function(a){return d.plumbing.get(a,b,{},c,d._getSourcesResponseMapper("persons","$personId",!1))})},b.prototype.getPersonSourcesQuery=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("person-sources-query-template",a,{pid:a}),function(a){return d.plumbing.get(a,b,{},c,d._getSourcesResponseMapper("persons","$personId",!0))})},b.prototype.getCoupleSourceRefs=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("couple-relationship-source-references-template",a,{crid:a}),function(a){return d.plumbing.get(a,b,{},c,d._getSourcesResponseMapper("relationships","$coupleId",!1))})},b.prototype.getCoupleSourcesQuery=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("couple-relationship-sources-query-template",a,{crid:a}),function(a){return d.plumbing.get(a,b,{},c,d._getSourcesResponseMapper("relationships","$coupleId",!0))})},b.prototype.getChildAndParentsSourceRefs=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("child-and-parents-relationship-source-references-template",a,{caprid:a}),function(a){return d.plumbing.get(a,b,{Accept:"application/x-fs-v1+json"},c,d._getSourcesResponseMapper("childAndParentsRelationships","$childAndParentsId",!1))})},b.prototype.getChildAndParentsSourcesQuery=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("child-and-parents-relationship-sources-template",a,{caprid:a}),function(a){return d.plumbing.get(a,b,{Accept:"application/x-fs-v1+json"},c,d._getSourcesResponseMapper("childAndParentsRelationships","$childAndParentsId",!0))})},b.prototype.deleteSourceDescription=function(a,b,d){var e=this,f=e.getSourceRefsQuery(a,{},d).then(function(g){var h=c.union(c.map(g.getPersonSourceRefs(),function(a){return e.deletePersonSourceRef(a.$getSourceRefUrl(),null,b,d)}),c.map(g.getCoupleSourceRefs(),function(a){return e.deleteCoupleSourceRef(a.$getSourceRefUrl(),null,b,d)}),c.map(g.getChildAndParentsSourceRefs(),function(a){return e.deleteChildAndParentsSourceRef(a.$getSourceRefUrl(),null,b,d)}));return e.helpers.promiseAll(h).then(function(){var c=e.helpers.chainHttpPromises(e.plumbing.getUrl("source-description-template",null,{sdid:a}),function(c){return e.plumbing.del(c,b?{"X-Reason":b}:{},d,function(){return a})});return e.helpers.extendHttpPromise(f,c),c})});return f},b.prototype.deletePersonSourceRef=function(a,b,c,d){var e=this;return e.helpers.chainHttpPromises(e.plumbing.getUrl("person-source-reference-template",a,{pid:a,srid:b}),function(b){return e.plumbing.del(b,c?{"X-Reason":c}:{},d,function(){return a})})},b.prototype.deleteCoupleSourceRef=function(a,b,c,d){var e=this;return e.helpers.chainHttpPromises(e.plumbing.getUrl("couple-relationship-source-reference-template",a,{crid:a,srid:b}),function(b){return e.plumbing.del(b,c?{"X-Reason":c}:{},d,function(){return a})})},b.prototype.deleteChildAndParentsSourceRef=function(a,b,c,d){var e=this;return e.helpers.chainHttpPromises(e.plumbing.getUrl("child-and-parents-relationship-source-reference-template",a,{caprid:a,srid:b}),function(b){var f={"Content-Type":"application/x-fs-v1+json"};return c&&(f["X-Reason"]=c),e.plumbing.del(b,f,d,function(){return a})})}},{"./../FamilySearch":1,"./../utils":47}],42:[function(a){var b=a("../FamilySearch"),c=a("../utils"),d=c.maybe,e={getRelationship:function(){return d(this.relationships)[0]},getPerson:function(a){return c.find(this.persons,{id:a})}};b.prototype.getCouple=function(a,b,d){var f=this;return f.helpers.chainHttpPromises(f.plumbing.getUrl("couple-relationship-template",a,{crid:a}),function(a){return f.plumbing.get(a,b,{},d,c.compose(c.objectExtender(e),function(a){return c.forEach(a.persons,function(a,b,c){c[b]=f.createPerson(a)}),c.forEach(a.relationships,function(a,b,c){c[b]=f.createCouple(a)}),a}))})},b.prototype.deleteCouple=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("couple-relationship-template",a,{crid:a}),function(e){return d.plumbing.del(e,b?{"X-Reason":b}:{},c,function(){return a})})}},{"../FamilySearch":1,"../utils":47}],43:[function(a){var b=a("./../FamilySearch"),c=a("./../utils"),d=c.maybe;b.prototype.getCurrentUser=function(a,b){var e=this;return e.helpers.chainHttpPromises(e.plumbing.getUrl("current-user"),function(f){return e.plumbing.get(f,a,{},b,c.compose(c.objectExtender({getUser:function(){return d(this.users)[0]}}),function(a){return c.forEach(a.users,function(a,b,c){c[b]=e.createUser(a)}),a}))})},b.prototype.getAgent=function(a,b,e){var f=this;return f.helpers.chainHttpPromises(f.plumbing.getUrl("agent-template",a,{uid:a}),function(a){return f.plumbing.get(a,b,{},e,c.compose(c.objectExtender({getAgent:function(){return d(this.agents)[0]}}),function(a){return c.forEach(a.agents,function(a,b,c){c[b]=f.createAgent(a)}),a}))})},b.prototype.getMultiAgent=function(a,b,d){var e=this,f={};return c.forEach(a,function(a){f[a]=e.getAgent(a,b,d)}),e.helpers.promiseAll(f)}},{"./../FamilySearch":1,"./../utils":47}],44:[function(a,b,c){var d=a("./utils"),c={};c.httpWrapper=function(a,b){return function(c,e,f,g,h){h=d.extend({url:e,method:c,json:!0,body:g},h),h.headers=d.extend({},f,h.headers),"multipart/form-data"===h.headers["Content-Type"]&&(h.formData=h.body,delete h.body,delete h.headers["Content-Type"],delete h.json);var i=b.settings.deferredWrapper(),j=i.promise,k=null,l={};return a(h,function(a,b,c){b&&(b.headers&&(l=b.headers),k=b.statusCode),a?i.reject(a):i.resolve(c)}),j.getStatusCode=function(){return k},j.getResponseHeader=function(a){return l[a]},j.getAllResponseHeaders=function(){return l},j.getRequest=function(){return h},j}},c.deferredWrapper=function(a){return function(){var b=a();return{promise:b.promise,resolve:b.resolve,reject:b.reject}}},b.exports=c},{"./utils":47}],45:[function(a,b){function c(a){var b,d,e,f,g,h,i,j="";for(b in a)if(a.hasOwnProperty(b))if(d=a[b],d instanceof Array)for(i=0;i<d.length;++i)g=d[i],e=b+"["+i+"]",h={},h[e]=g,j+=c(h)+"&";else if(d instanceof Object)for(f in d)d.hasOwnProperty(f)&&(g=d[f],e=b+"["+f+"]",h={},h[e]=g,j+=c(h)+"&");else void 0!==d&&null!==d&&(j+=encodeURIComponent(b)+"="+encodeURIComponent(d)+"&");return j.length?j.substr(0,j.length-1):j}var d=a("./utils"),e=function(a){this.client=a,this.helpers=a.helpers,this.settings=a.settings,this.totalProcessingTime=0};e.prototype.getTotalProcessingTime=function(){return this.totalProcessingTime},e.prototype.setTotalProcessingTime=function(a){this.totalProcessingTime=a},e.prototype.getUrl=function(a,b,c){var d=this;return this.settings.discoveryPromise.then(function(e){var f="";return f=d.helpers.isAbsoluteUrl(b)?b:d.helpers.getUrlFromDiscoveryResource(e,a,c)})},e.prototype.get=function(a,b,c,e,f){return this.http("GET",this.helpers.appendQueryParameters(a,b),d.extend({Accept:"application/x-gedcomx-v1+json"},c),null,e,f)},e.prototype.post=function(a,b,c,e,f){return this.http("POST",a,d.extend({"Content-Type":"application/x-gedcomx-v1+json"},c),b,e,f)},e.prototype.put=function(a,b,c,e,f){return this.http("PUT",a,d.extend({"Content-Type":"application/x-gedcomx-v1+json"},c),b,e,f)},e.prototype.del=function(a,b,c,e){return this.http("DELETE",a,d.extend({"Content-Type":"application/x-gedcomx-v1+json"},b),null,c,e)},e.prototype.transformData=function(a,b){if(a&&d.isObject(a)&&"[object FormData]"!==String(a)){if(a=d.clonePartial(a,function(a){return!(d.isString(a)&&("$"===a.charAt(0)||"_"===a.charAt(0)))}),"application/x-www-form-urlencoded"===b)return c(a);if(b&&-1!==b.indexOf("json"))return JSON.stringify(a)}return a},e.prototype.http=function(a,b,c,d,e,f,g){var h=this.settings.deferredWrapper(),i=h.promise,j=this,k=this.helpers.getAPIServerUrl(b);c=c||{};var l;return l=this.settings.accessToken||!this.settings.autoSignin||this.helpers.isOAuthServerUrl(k)||b===this.settings.discoveryUrl?this.helpers.refPromise(this.settings.accessToken):this.settings.getAccessToken(),l.then(function(){var l=j.helpers.isAuthoritiesServerUrl(k)?"sessionId":"access_token";if(j.settings.accessToken&&-1===k.indexOf(l+"=")){var m={};m[l]=j.settings.accessToken,k=j.helpers.appendQueryParameters(k,m)}null==g&&(g=j.settings.maxHttpRequestRetries);var n=j.settings.httpWrapper(a,k,c,j.transformData(d,c["Content-Type"]),e||{});j.helpers.extendHttpPromise(i,n),n.then(function(b){"GET"===a&&204===n.getStatusCode()&&(b={}),j.helpers.refreshAccessToken();var c=n.getResponseHeader("X-PROCESSING-TIME");c&&(j.totalProcessingTime+=parseInt(c,10)),f&&(b=f(b,n)),h.resolve(b)},function(){var k=n.getStatusCode();if(j.helpers.log("http failure",k,g,n.getAllResponseHeaders()),401===k&&j.helpers.eraseAccessToken(),"GET"===a&&k>=500&&g>0||429===k){var l=n.getResponseHeader("Retry-After"),m=l?parseInt(l,10):j.settings.defaultThrottleRetryAfter;j.settings.setTimeout(function(){n=j.http(a,b,c,d,e,f,g-1),j.helpers.extendHttpPromise(i,n),n.then(function(a){h.resolve(a)},function(){h.reject.apply(h,arguments)})},m)}else h.reject.apply(h,arguments)})},function(){h.reject.apply(h,arguments)}),i},b.exports=e},{"./utils":47}],46:[function(a,b,c){var d=a("./FamilySearch"),e=a("./utils"),f=e.maybe,c={};c.setMember=function(a,b){this[a]||(this[a]={}),b instanceof d.Person?(this[a].resource=b.$getPersonUrl(),delete this[a].resourceId):this.$helpers.isAbsoluteUrl(b)?(this[a].resource=b,delete this[a].resourceId):e.isString(b)?(this[a].resourceId=b,delete this[a].resource):this[a]=b},c.deleteMember=function(a,b){this.$deletedMembers||(this.$deletedMembers={}),this.$deletedMembers[a]=b,delete this[a]},c.setFacts=function(a,b,d){e.isArray(this[a])&&e.forEach(this[a],function(b){c.deleteFact.call(this,a,b,d)},this),this[a]=[],e.forEach(b,function(b){c.addFact.call(this,a,b)},this)},c.addFact=function(a,b){e.isArray(this[a])||(this[a]=[]),b instanceof d.Fact||(b=this.$client.createFact(b)),this[a].push(b)},c.deleteFact=function(a,b,c){b instanceof d.Fact||(b=e.find(this[a],{id:b}));var g=e.indexOf(this[a],b);if(g>=0){var h=this.$helpers.removeAccessToken(f(f(f(b).links).conclusion).href);h&&(this.$deletedFacts||(this.$deletedFacts={}),this.$deletedFacts[h]=c),this[a].splice(g,1)}},b.exports=c},{"./FamilySearch":1,"./utils":47}],47:[function(a,b,c){function d(a,b){for(var c in a)if(a.hasOwnProperty(c)&&b[c]!==a[c])return!1;return!0}var c=b.exports;Object.create||(Object.create=function(){function a(){}return function(b){if(1!==arguments.length)throw new Error("Object.create implementation only accepts one parameter.");return a.prototype=b,new a}}()),"function"!=typeof Object.getPrototypeOf&&(Object.getPrototypeOf="object"==typeof"".__proto__?function(a){return a.__proto__}:function(a){return a.constructor.prototype}),c.isArray=function(a){return Array.isArray?Array.isArray(a):"[object Array]"==Object.prototype.toString.call(a)},c.isString=function(a){return"[object String]"==Object.prototype.toString.call(a)},c.isFunction=function(a){return"function"!=typeof/./?"function"==typeof a:"[object Function]"==Object.prototype.toString.call(a)},c.isObject=function(a){return a===Object(a)},c.isUndefined=function(a){return void 0===a};var e=c.forEach=function(a,b,c){if(null!=a)if(Array.prototype.forEach&&a.forEach===Array.prototype.forEach)a.forEach(b,c);else if(a.length===+a.length){for(var d=0,e=a.length;e>d;d++)if(b.call(c,a[d],d,a)==={})return}else for(var f in a)if(a.hasOwnProperty(f)&&b.call(c,a[f],f,a)==={})return};c.removeEmptyProperties=function(a){return e(a,function(b,c){(null==b||""===b)&&delete a[c]}),a},c.keys=Object.keys||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b},c.filter=function(a,b,f){var g=[],h=c.isFunction(b);return e(a,function(a){(h?b.call(f,a):d(b,a))&&g.push(a)}),g},c.map=function(a,b,c){var d=[];return e(a,function(a,e,f){d.push(b.call(c,a,e,f))}),d},c.contains=function(a,b){if(null==a)return!1;if(a.indexOf&&a.indexOf===Array.prototype.indexOf)return-1!==a.indexOf(b);var c=!1;return e(a,function(a){a===b&&(c=!0)}),c},c.indexOf=function(a,b){if(Array.prototype.indexOf===a.indexOf)return a.indexOf(b);for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return c;return-1},c.uniq=function(a){var b=[];return e(a,function(a){c.contains(b,a)||b.push(a)}),b},c.find=function(a,b,e){var f,g=c.isFunction(b);if(a)for(var h=0,i=a.length;i>h;h++){var j=a[h];if(g?b.call(e,j):d(b,j)){f=j;break}}return f},c.findIndex=function(a,b,e){var f=-1,g=c.isFunction(b);if(a)for(var h=0,i=a.length;i>h;h++){var j=a[h];if(g?b.call(e,j):d(b,j)){f=h;break}}return f},c.compose=function(){var a=arguments;return function(){for(var b=arguments,c=a.length-1;c>=0;c--)a[c]&&(b=[a[c].apply(this,b)]);return b[0]}},c.flatten=function(a){var b=[];return e(a,function(a){c.isArray(a)&&Array.prototype.push.apply(b,a)}),b},c.flatMap=c.compose(c.flatten,c.map),c.union=function(){return c.uniq(c.flatten(arguments))},c.findOrFirst=function(a,b){if(!c.isUndefined(a)){var d=c.find(a,b);return c.isUndefined(d)?a[0]:d}return void 0},c.extend=function(a){return a=a||{},e(Array.prototype.slice.call(arguments,1),function(b){b&&e(b,function(b,c){a[c]=b})}),a},c.partialRight=function(a){var b=Array.prototype.slice.call(arguments,1);return function(){return a.apply(this,Array.prototype.slice.call(arguments).concat(b))}},c.partial=function(a){var b=Array.prototype.slice.call(arguments,1);return function(){return a.apply(this,b.concat(Array.prototype.slice.call(arguments)))}},c.maybe=function(a){return null!=a?a:{}},c.clonePartial=function(a,b){var d;if(null==a||"object"!=typeof a)return a;if(a instanceof Date)return d=new Date,d.setTime(a.getTime()),d;if(a instanceof Array){d=[];for(var e=0,f=a.length;f>e;e++)(!b||b(e))&&d.push(c.clonePartial(a[e],b));return d}if(a instanceof Object){d=Object.create(Object.getPrototypeOf(a));for(var g in a)!a.hasOwnProperty(g)||b&&!b(g)||(d[g]=c.clonePartial(a[g],b));return d}throw new Error("Unable to copy obj")},c.objectExtender=function(a,b){return function(d){return d&&(b?e(b(d),function(b){c.extend(b,c.isFunction(a)?a(d,b):a)}):c.extend(d,c.isFunction(a)?a(d,d):a)),d}},c.appFieldRejector=function(a){return!(c.isString(a)&&"_"===a.charAt(0))},c.deletePropertiesPartial=function(a,b){for(var c in a)!a.hasOwnProperty(c)||b&&!b(c)||delete a[c]},c.wrapFunctions=function(a,b,c){return e(c,function(c){a[c]=function(){return b[c].apply(b,arguments)}}),a}},{}]},{},[1])(1)});